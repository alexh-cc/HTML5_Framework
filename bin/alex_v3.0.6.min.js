var alex={version:"3.0.6"};console.log("alex.js - version "+alex.version),alex.load={},alex.utils={},alex.display={},alex.ui={},alex.motion={},alex.screens={},alex.audio={},alex.game={},PIXI.DisplayObject.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},PIXI.Container.prototype.contains=function(child){return this.children.indexOf(child)>-1},PIXI.extras.BitmapText.prototype.updateText=function(){for(var data=PIXI.extras.BitmapText.fonts[this._font.name],pos=new PIXI.Point,prevCharCode=null,chars=[],lastLineWidth=0,maxLineWidth=0,lineWidths=[],line=0,scale=this._font.size/data.size*data.baseTexture.resolution,lastSpace=-1,maxLineHeight=0,i=0;i<this.text.length;i++){var charCode=this.text.charCodeAt(i);if(lastSpace=/(\s)/.test(this.text.charAt(i))?i:lastSpace,/(?:\r\n|\r|\n)/.test(this.text.charAt(i)))lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null;else if(-1!==lastSpace&&this.maxWidth>0&&pos.x*scale>this.maxWidth)PIXI.utils.removeItems(chars,lastSpace,i-lastSpace),i=lastSpace,lastSpace=-1,lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null;else{var charData=data.chars[charCode];charData&&(prevCharCode&&charData.kerning[prevCharCode]&&(pos.x+=charData.kerning[prevCharCode]),chars.push({texture:charData.texture,line:line,charCode:charCode,position:new PIXI.Point(pos.x+charData.xOffset,pos.y+charData.yOffset)}),lastLineWidth=pos.x+(charData.texture.width+charData.xOffset),pos.x+=charData.xAdvance,maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height),prevCharCode=charCode)}}lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),this.numLines=line+1;var lineAlignOffsets=[];for(i=0;line>=i;i++){var alignOffset=0;"right"===this._font.align?alignOffset=maxLineWidth-lineWidths[i]:"center"===this._font.align&&(alignOffset=(maxLineWidth-lineWidths[i])/2),lineAlignOffsets.push(alignOffset)}var lenChars=chars.length,tint=this.tint;for(i=0;lenChars>i;i++){var c=this._glyphs[i];c?c.texture=chars[i].texture:(c=new PIXI.Sprite(chars[i].texture),this._glyphs.push(c)),c.position.x=(chars[i].position.x+lineAlignOffsets[chars[i].line])*scale,c.position.y=chars[i].position.y*scale,c.scale.x=c.scale.y=scale,c.tint=tint,c.parent||this.addChild(c)}for(i=lenChars;i<this._glyphs.length;++i)this.removeChild(this._glyphs[i]);this.textWidth=maxLineWidth*scale,this.textHeight=(pos.y+data.lineHeight)*scale,this.maxLineHeight=maxLineHeight*scale},PIXI.interaction.InteractionManager.prototype.getTouchData=function(touchEvent){var touchData=this.interactiveDataPool.pop();return touchData||(touchData=new PIXI.interaction.InteractionData),touchData.identifier=touchEvent.identifier,this.mapPositionToPoint(touchData.global,touchEvent.clientX,touchEvent.clientY),navigator.isCocoonJS&&(touchData.global.x=touchData.global.x/this.resolution,touchData.global.y=touchData.global.y/this.resolution),touchEvent.globalX=touchData.global.x,touchEvent.globalY=touchData.global.y,touchData.originalTouch=touchEvent,touchData},alex.settings={DEFAULT_W:568,DEFAULT_H:320,STAGE_W:568,STAGE_H:320,MIN_W:400,MIN_H:320,IPAD_W:512,IPAD_H:384,IPAD_MIN:288,CONTENT_SCALE:1,FONT:"Arial",BG_COLOR:"#000000",IFRAME_MODE:2,RES_2_MIN_H:320,RES_2_MIN_W:640,MAX_RESOLUTON:2,ORIENTATION:2,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,USE_WIDTH:!1,SCALE_MODES:{MATCH_HEIGHT:1,MATCH_WIDTH:2},MUTE_STATE:!1,CHECK_ORIENTATION:!0,FULLSCREEN_ENABLED:!0,DESKTOP_FULLSCREEN:!1,DESKTOP_RESIZE:!0,WEB_AUDIO_ENABLED:!0,WEB_GL_ENABLED:!0,AUDIO_ENABLED:!0,IMG_DIR:"./img/",SND_DIR:"./snd/",JSON_DIR:"./json/",FONT_DIR:"./font/",GAME_ID:"template_game",FIRST_SCREEN:"title",copy:function(vars){for(var s in vars)vars.hasOwnProperty(s)&&(this[s]=vars[s]);vars.ROOT_DIR&&this.setRootDir(vars.ROOT_DIR)},setIpad:function(){var isLandscape=this.ORIENTATION===this.ORIENTATION_LANDSCAPE,w=this.IPAD_W,h=this.IPAD_H,min=this.IPAD_MIN;this.DEFAULT_W=this.STAGE_W=isLandscape?w:h,this.DEFAULT_H=this.STAGE_H=isLandscape?h:w,this.MIN_W=isLandscape?w:min,this.MIN_H=isLandscape?min:w},setIphone:function(){var isLandscape=this.ORIENTATION===this.ORIENTATION_LANDSCAPE,minW=this.MIN_W,minH=this.MIN_H,stageW=this.STAGE_W,stageH=this.STAGE_H;this.DEFAULT_W=this.STAGE_W=isLandscape?stageW:stageH,this.DEFAULT_H=this.STAGE_H=isLandscape?stageH:stageW,this.MIN_W=isLandscape?minW:minH,this.MIN_H=isLandscape?minH:minW},setRootDir:function(root){var lastChar=root.charAt(root.length-1);"/"!=lastChar&&(root+="/"),this.IMG_DIR=root+"img/",this.SND_DIR=root+"snd/",this.JSON_DIR=root+"json/",this.FONT_DIR=root+"font/"}},game_shell.Keys={_pressed:{},LEFT_KEY:37,ENTER_KEY:13,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,SPACE_KEY:32,SHIFT_KEY:16,UP:0,JUST_PRESSED:1,DOWN:2,onKeydown:function(event){this._pressed[event.keyCode]||(this._pressed[event.keyCode]=this.JUST_PRESSED);var evt=event||window.event;void 0!==evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0,evt.preventDefault&&evt.preventDefault()},onKeyup:function(event){delete this._pressed[event.keyCode];var evt=event||window.event;void 0!==evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0,evt.preventDefault&&evt.preventDefault()},update:function(dt){for(var s in this._pressed)this._pressed.hasOwnProperty(s)&&this._pressed[s]===this.JUST_PRESSED&&(this._pressed[s]=this.DOWN)},clear:function(){for(var s in this._pressed)this._pressed.hasOwnProperty(s)&&delete this._pressed[s]},enable:function(bool){this.boundKeyUp||(this.boundKeyUp=this.onKeyup.bind(this)),this.boundKeyDown||(this.boundKeyDown=this.onKeydown.bind(this));var isIframe=window.parent!==window,w=isIframe?document:window;w.removeEventListener("keyup",this.boundKeyUp),w.removeEventListener("keydown",this.boundKeyDown),bool?(w.addEventListener("keyup",this.boundKeyUp,!1),w.addEventListener("keydown",this.boundKeyDown,!1),isIframe&&window.focus()):this.clear()},isDown:function(keyCode){return this._pressed[keyCode]>0},wasPressed:function(keyCode){return this._pressed[keyCode]===this.JUST_PRESSED},keyState:function(code){return this._pressed[code]||this.UP}},game_shell.KeyListener=function(){},game_shell.KeyListener.prototype=Object.create(game_shell.Keys),game_shell.KeyListener.prototype.constructor=game_shell.KeyListener,alex.utils.EventDispatcher=function(){},alex.utils.EventDispatcher.prototype={constructor:alex.utils.EventDispatcher,apply:function(object){object.addEventListener=alex.utils.EventDispatcher.prototype.addEventListener,object.on=alex.utils.EventDispatcher.prototype.addEventListener,object.hasEventListener=alex.utils.EventDispatcher.prototype.hasEventListener,object.has=alex.utils.EventDispatcher.prototype.hasEventListener,object.removeEventListener=alex.utils.EventDispatcher.prototype.removeEventListener,object.off=alex.utils.EventDispatcher.prototype.removeEventListener,object.removeEventListeners=alex.utils.EventDispatcher.prototype.removeEventListeners,object.offAll=alex.utils.EventDispatcher.prototype.removeEventListeners,object.dispatchEvent=alex.utils.EventDispatcher.prototype.dispatchEvent,object.emit=alex.utils.EventDispatcher.prototype.dispatchEvent},addEventListener:function(type,listener){void 0===this._listeners&&(this._listeners={});var listeners=this._listeners;void 0===listeners[type]&&(listeners[type]=[]),-1===listeners[type].indexOf(listener)&&listeners[type].push(listener)},hasEventListener:function(type,listener){if(void 0===this._listeners)return!1;var listeners=this._listeners;return void 0!==listeners[type]&&-1!==listeners[type].indexOf(listener)},removeEventListener:function(type,listener){if(void 0!==this._listeners){var listeners=this._listeners,index=listeners[type].indexOf(listener);-1!==index&&listeners[type].splice(index,1)}},removeEventListeners:function(){if(void 0!==this._listeners){var listeners=this._listeners;for(var s in listeners)delete listeners[s]}},dispatchEvent:function(event){if(void 0!==this._listeners){var listeners=this._listeners,listenerArray=listeners[event.type];if(void 0!==listenerArray){event.target=this;for(var i=0,l=listenerArray.length;l>i;i++)listenerArray[i].call(this,event)}}},dispose:function(){void 0!==this._listeners&&(this._listeners.length=0,this._listeners=null)}},alex.utils.EventDispatcher.prototype.on=alex.utils.EventDispatcher.prototype.addEventListener,alex.utils.EventDispatcher.prototype.emit=alex.utils.EventDispatcher.prototype.dispatchEvent,alex.utils.EventDispatcher.prototype.has=alex.utils.EventDispatcher.prototype.hasEventListener,alex.utils.EventDispatcher.prototype.off=alex.utils.EventDispatcher.prototype.removeEventListener,alex.utils.EventDispatcher.prototype.offAll=alex.utils.EventDispatcher.prototype.removeEventListeners,alex.utils.EventQueue=function(){alex.utils.EventDispatcher.call(this),this.queue=[]},alex.utils.EventQueue.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.utils.EventQueue.prototype.constructor=alex.utils.EventQueue,alex.utils.EventQueue.prototype.queueEvent=function(event){this.queue[this.queue.length]=event},alex.utils.EventQueue.prototype.dispatchQueuedEvents=alex.utils.EventQueue.prototype.update=function(delta){for(;this.queue.length>0;)this.dispatchEvent(this.queue.shift())},alex.utils.Randomise={HOLDER:[],randomise:function(p_list){this.HOLDER.length=0;var i,l_nItems=p_list.length;for(i=0;l_nItems>i;i++)this.HOLDER[i]=p_list[i];for(p_list.length=0;this.HOLDER.length>0;){var index=this.randomInt(this.HOLDER.length-1);p_list[p_list.length]=this.HOLDER.splice(index,1)[0]}},randomisedCopy:function(p_list){for(var randomised=[],list=p_list.slice();list.length>0;){var index=this.randomInt(list.length-1);randomised[randomised.length]=list.splice(index,1)[0]}return randomised},randomNumber:function(range){return Math.random()*range},randomInRange:function(p_min,p_max){var dif=p_max-p_min;return p_min+Math.random()*dif},randomInt:function(range){return Math.floor(Math.random()*(range+1))}},alex.utils.Timer=function(p_interval,p_repeat){alex.utils.EventDispatcher.call(this),this.interval=p_interval||1e3,"undefined"!=typeof p_repeat?this.repeat=p_repeat:this.repeat=-1,this.running=!1,this.currentTime=0,this.tickCount=0,this.evt={time:0,count:0},this.onTimer=function(p_count){},this.onTimerComplete=function(){}},alex.utils.Timer.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.utils.Timer.prototype.constructor=alex.utils.Timer,alex.utils.Timer.prototype.start=function(){this.running=!0,this.currentTime=0,this.tickCount=0},alex.utils.Timer.prototype.stop=function(){this.running=!1},alex.utils.Timer.prototype.resume=function(){this.running=!0},alex.utils.Timer.prototype.reset=function(){this.running=!1,this.currentTime=0,this.tickCount=0},Object.defineProperties(alex.utils.Timer.prototype,{isComplete:{get:function(){return this.tickCount===this.repeat}},remaining:{get:function(){return this.repeat-this.tickCount}}}),alex.utils.Timer.prototype.update=function(elapsed){this.running&&(this.currentTime+=elapsed,this.currentTime>this.interval&&this.tick())},alex.utils.Timer.prototype.tick=function(){this.currentTime-=this.interval,this.tickCount++,this.evt.time=this.currentTime,this.evt.count=this.tickCount,this.evt.countDown=this.repeat-this.tickCount,this.evt.type="timer",this.dispatchEvent(this.evt),this.onTimer(this.tickCount),this.tickCount===this.repeat&&(this.stop(),this.evt.type="complete",this.dispatchEvent(this.evt),this.onTimerComplete())},alex.utils.Timer.prototype.dispose=function(){this.onTimer=null,this.onTimerComplete=null,alex.utils.EventDispatcher.prototype.dispose.call(this)},alex.utils.RandomTimer=function(p_interval){p_interval||(p_interval=3e3),alex.utils.Timer.call(this,p_interval),this.baseInterval=this.interval},alex.utils.RandomTimer.prototype=Object.create(alex.utils.Timer.prototype),alex.utils.RandomTimer.constructor=alex.utils.RandomTimer,alex.utils.RandomTimer.prototype.start=function(){alex.utils.Timer.prototype.start.call(this),this.currentTime=Math.floor(Math.random()*this.baseInterval)},alex.utils.RandomTimer.prototype.tick=function(){alex.utils.Timer.prototype.tick.call(this),this.interval=this.baseInterval+Math.floor(Math.random()*this.baseInterval)},alex.utils.DelayedAction=function(poolSize){var size=poolSize||50;this.createPool(size),this._actions=[]},alex.utils.DelayedAction.prototype.createPool=function(size){for(this._pool=[];size>0;)this._pool[this._pool.length]={_targetTime:-1,_callback:null},size--},alex.utils.DelayedAction.prototype._next=function(){var item=this._pool.shift();return this._pool[this._pool.length]=item,item},alex.utils.DelayedAction.prototype.delay=function(p_callback,p_ms,p_scope){var action=this._next();return action._targetTime=p_ms||-1,"undefined"!=typeof p_scope?action._callback=function(){p_callback.call(p_scope)}:action._callback=p_callback||null,this._actions[this._actions.length]=action,action},alex.utils.DelayedAction.prototype.update=function(elapsedTime){var n=this._actions.length;if(n>0){var i,action;for(i=n-1;i>-1;i--)if(action=this._actions[i],action._targetTime>0&&action._callback&&(action._targetTime-=elapsedTime,action._targetTime<=0)){var callback=action._callback;action._callback=null,action._targetTime=-1,this._actions.splice(i,1),callback()}}},alex.utils.DelayedAction.prototype.clear=alex.utils.DelayedAction.prototype.purge=function(){var n=this._actions.length;if(n>0){var i,action;for(i=n-1;i>-1;i--)action=this._actions[i],action._callback=null,action._targetTime=-1}this._actions.length=0},alex.utils.DelayedAction.prototype.dispose=function(){this.clear(),this._pool=null},alex.utils.SystemInfo=function(){this.browser=-1,this.os=-1,this.device=-1,this.browserUnknown=-1,this.browserSafari=1,this.browserIE=2,this.browserFirefox=3,this.browserChrome=4,this.browserAndroidStock=5,this.browserKindleSilk=6,this.browserOpera=7,this.deviceUnknown=-1,this.deviceDesktop=1,this.deviceMobile=2,this.osUnknown=-1,this.osWindows=1,this.osOSX=2,this.osLinux=3,this.osIOS=4,this.osAndroid=5,this.osBlackberry=6,this.osVersion=-1,this.audioType="",this.webAudio=!1},alex.utils.SystemInfo.prototype.run=function(){this._checkDevice(),this._checkAudio()},alex.utils.SystemInfo.prototype._checkDevice=function(){var systemString=navigator.userAgent;if(systemString.length>0)if(null!==systemString.match(/mobile/i)?this.device=this.deviceMobile:null!==systemString.match(/tablet/i)?this.device=this.deviceMobile:null!==systemString.match(/android/i)?this.device=this.deviceMobile:this.device=this.deviceDesktop,null!==systemString.match(/windows/i)?this.os=this.osWindows:null!==systemString.match(/iphone os/i)?this.os=this.osIOS:null!==systemString.match(/ipad/i)?this.os=this.osIOS:null!==systemString.match(/mac os x/i)?this.device===this.deviceMobile?this.os=this.osIOS:this.os=this.osOSX:null!==systemString.match(/android/i)?this.os=this.osAndroid:null!==systemString.match(/linux/i)&&(this.os=this.osLinux),null!==systemString.match(/MSIE/i)||null!==systemString.match(/rv:11.0/i)?this.browser=this.browserIE:this.os!==this.osAndroid||null===systemString.match(/samsung/i)&&null===systemString.match(/534.30/i)&&null===systemString.match(/535.19/i)?null!==systemString.match(/silk/i)||null!==systemString.match(/kindle fire/i)?this.browser=this.browserKindleSilk:null!==systemString.match(/chrome/i)?this.browser=this.browserChrome:null!==systemString.match(/CriOS/i)?this.browser=this.browserChrome:null!==systemString.match(/Firefox/i)?this.browser=this.browserFirefox:null!==systemString.match(/safari/i)&&(this.browser=this.browserSafari):this.browser=this.browserAndroidStock,this.os===this.osIOS)null!==systemString.match(/iPhone OS 5/i)?this.osVersion=5:null!==systemString.match(/iPhone OS 6/i)?this.osVersion=6:null!==systemString.match(/(iPad|iPhone);.*CPU.*OS 7_\d/i)?this.osVersion=7:null!==systemString.match(/(iPad|iPhone);.*CPU.*OS 8_\d/i)?this.osVersion=8:null!==systemString.match(/(iPad|iPhone);.*CPU.*OS 9_\d/i)&&(this.osVersion=9);else if(this.os===this.osAndroid)try{var androidVersionString=systemString.match(/Android [\d+(?:\.\d+]{3,5}/)[0].replace("Android ","");this.osVersion=parseFloat(androidVersionString)}catch(e){this.osVersion=-1}},alex.utils.SystemInfo.prototype._checkAudio=function(){var canPlayOgg=!0;if(this.isIOS||this.browser===this.browserSafari)canPlayOgg=!1;else{var a=document.createElement("audio");canPlayOgg=!(!a.canPlayType||!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""))}canPlayOgg?this.audioType=".ogg":this.audioType=".m4a",window.AudioContext?this.webAudio=!0:window.webkitAudioContext?this.webAudio=!0:this.webAudio=!1},Object.defineProperties(alex.utils.SystemInfo.prototype,{isAndroidStock:{get:function(){return this.browser===this.browserAndroidStock}},isIOS:{get:function(){return this.os===this.osIOS}},isMobile:{get:function(){return this.device===this.deviceMobile}},isDesktop:{get:function(){return this.device===this.deviceDesktop}},isAndroid:{get:function(){return this.os===this.osAndroid}},isSafari:{get:function(){return this.browser===this.browserSafari}},isMobileSafari:{get:function(){return this.os===this.osIOS&&this.isSafari}},isIE:{get:function(){return this.browser===this.browserIE}}}),alex.utils.FullscreenMgr=function(){this.canvas=null,this.isMobile=!1,this.fullScreenState=!1,this.isFullScreen=!1,this.fullscreenChanged=this._fullscreenChanged.bind(this),this.goFullscreen=this._goFullscreen.bind(this)},alex.utils.FullscreenMgr.prototype.init=function(config){this.canvas=config.canvas,this.isMobile=config.isMobile,this.isAvailable=this.checkAvailable(),this.activate(this.isAvailable)},alex.utils.FullscreenMgr.prototype.activate=function(state){this.fullScreenState=state,this.canvas.removeEventListener("click",this.goFullscreen),this.canvas.removeEventListener("touchstart",this.goFullscreen),state&&(this.canvas.addEventListener("click",this.goFullscreen,!1),this.canvas.addEventListener("touchstart",this.goFullscreen,!1))},alex.utils.FullscreenMgr.prototype._goFullscreen=function(){var gameDiv=document.documentElement;gameDiv.requestFullscreen?gameDiv.requestFullscreen():gameDiv.mozRequestFullScreen?gameDiv.mozRequestFullScreen():gameDiv.webkitRequestFullscreen?gameDiv.webkitRequestFullscreen():gameDiv.msRequestFullscreen&&gameDiv.msRequestFullscreen(),this.activate(!1)},alex.utils.FullscreenMgr.prototype.reactivate=function(){this.activate(!this.isFullScreen)},alex.utils.FullscreenMgr.prototype.checkAvailable=function(){var doc=document.documentElement;doc.allowfullscreen=!0;var available=doc.requestFullscreen||doc.webkitRequestFullscreen||doc.msRequestFullscreen||doc.mozRequestFullScreen;if(available){var self=this;document.onfullscreenchange=function(event){self.fullscreenChanged(event)},document.onwebkitfullscreenchange=function(event){self.fullscreenChanged(event)},document.onmozfullscreenchange=function(event){self.fullscreenChanged(event)},document.onmsfullscreenchange=function(event){self.fullscreenChanged(event)},document.onfullscreenerror=function(event){self.fullscreenError(event)},document.onmozfullscreenerror=function(event){self.fullscreenError(event)},document.onwebkitfullscreenerror=function(event){self.fullscreenError(event)},document.onmsfullscreenerror=function(event){self.fullscreenError(event)}}return available},alex.utils.FullscreenMgr.prototype._fullscreenChanged=function(event){var fullscreenElement=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;this.isFullScreen=null!==fullscreenElement&&"undefined"!=typeof fullscreenElement,console.log("FullscreenMg -> fullscreenChanged -- isFullScreen: "+this.isFullScreen),this.isFullScreen||this.isMobile&&this.activate(!0)},alex.utils.FullscreenMgr.prototype.fullscreenError=function(event){console.log("* !!!! fullscreenError !!! * "+event),console.log("* event.message: "+event.message),this.fullscreenChanged(null)},alex.utils.UpdateLoop=function(fps){this.gameLoopId=-1,this.fps=fps||60,this.interval=1e3/this.fps,this.accumulator=0,this.currentTime=0,this.gameLoop=this._gameLoop.bind(this)},alex.utils.UpdateLoop.prototype.start=function(){clearInterval(this.gameLoopId),this.currentTime=Date.now(),this.gameLoopId=setInterval(this.gameLoop,this.interval)},alex.utils.UpdateLoop.prototype.stop=function(){clearInterval(this.gameLoopId)},alex.utils.UpdateLoop.prototype.updateGame=function(p_time){},alex.utils.UpdateLoop.prototype._gameLoop=function(){var newTime=Date.now(),elapsed=newTime-this.currentTime;this.currentTime=newTime,this.accumulator+=elapsed;for(var chunk=this.interval;this.accumulator>chunk;)this.accumulator-=chunk,this.updateGame(chunk)},alex.utils.RenderLoop=function(){this.currentTime=0,this.requestId=-1,this.stage=null,this.screenMgr=null},alex.utils.RenderLoop.prototype.init=function(p_config){this.stage=p_config.stage,this.screenMgr=p_config.screenMgr,p_config.useStats?this.render=this._statsRender.bind(this):this.render=this._defaultRender.bind(this)},alex.utils.RenderLoop.prototype._defaultRender=function(){var newTime=Date.now(),elapsed=newTime-this.currentTime;this.currentTime=newTime,this.stage.draw(),this.screenMgr.render(elapsed),this.requestId=requestAnimationFrame(this.render)},alex.utils.RenderLoop.prototype._statsRender=function(){stats.begin();var newTime=Date.now(),elapsed=newTime-this.currentTime;this.currentTime=newTime,this.stage.draw(),this.screenMgr.render(elapsed),stats.end(),this.requestId=requestAnimationFrame(this.render)},alex.utils.RenderLoop.prototype.start=function(){this.currentTime=Date.now(),this.render()},alex.utils.RenderLoop.prototype.stop=function(){cancelAnimationFrame(this.requestId)},alex.utils.Resolution=function(){this.resolution=1,this.minHeight2=alex.settings.RES_2_MIN_H||320,this.minHeight4=2*this.minHeight2,this.minWidth2=alex.settings.RES_2_MIN_W||512,this.minWidth4=2*this.minWidth2,this.maxResolution=alex.settings.MAX_RESOLUTON,this.pixelRatio=window.devicePixelRatio||1},alex.utils.Resolution.prototype.init=function(config){this.forceResolution=config.forceResolution,this.forceResolution>-1&&(this.resolution=this.forceResolution)},alex.utils.Resolution.prototype.setByHeight=function(){if(this.forceResolution>-1)this.resolution=this.forceResolution;else{var shortEdge=Math.min(window.innerHeight,window.innerWidth),size=Math.round(shortEdge*this.pixelRatio);size<=this.minHeight2?this.resolution=1:size<=this.minHeight4?this.resolution=2:this.resolution=this.maxResolution>2?4:2}return console.warn("resolution = "+this.resolution),this.resolution},alex.utils.Resolution.prototype.setByWidth=function(){if(this.forceResolution>-1)this.resolution=this.forceResolution;else{var longEdge=Math.max(window.innerHeight,window.innerWidth),size=Math.round(longEdge*this.pixelRatio);size<=this.minWidth2?this.resolution=1:size<=this.minWidth4?this.resolution=2:this.resolution=this.maxResolution>2?4:2}return console.log("Resolution -> setResolution: "+this.resolution),this.resolution},alex.utils.Viewport=function(){alex.utils.EventDispatcher.call(this),this.PORTRAIT=alex.settings.ORIENTATION_PORTRAIT,this.LANDSCAPE=alex.settings.ORIENTATION_LANDSCAPE,this.scaleModes=alex.settings.SCALE_MODES,this.settings=null,this.resize=alex.utils.Viewport.prototype.resize.bind(this)},alex.utils.Viewport.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.utils.Viewport.prototype.constructor=alex.utils.Viewport,alex.utils.Viewport.prototype.IFRAME_MODE_1=1,alex.utils.Viewport.prototype.IFRAME_MODE_2=2,alex.utils.Viewport.prototype.init=function(config){this.CHECK_ORIENTATION=config.CHECK_ORIENTATION,this.DESKTOP_RESIZE=config.DESKTOP_RESIZE,this.isMobile=config.isMobile,this.DEFAULT_W=config.DEFAULT_W,this.DEFAULT_H=config.DEFAULT_H,this.MIN_W=config.MIN_W,this.MIN_H=config.MIN_H,this.rotateImg=config.rotateImg,this.gameDiv=config.gameDiv,this.pixelRatio=window.devicePixelRatio||1,this.isIframe=window.parent!==window,this.iframeMode=config.iframeMode||this.IFRAME_MODE_2,this.settings=this.createSettings(config),this.eventResize={type:"resize",wrongOrientation:!1,settings:this.settings},this.initResize(),this.setScaleMode(config.scaleMode||this.settings.SCALE_MATCH_HEIGHT)},alex.utils.Viewport.prototype.initResize=function(){window.addEventListener("resize",this.resize,!1),window.addEventListener("orientationchange",this.resize,!1)},alex.utils.Viewport.prototype.resize=function(){this.eventResize.settings=this.getSize(),this.emit(this.eventResize)},alex.utils.Viewport.prototype.setScaleMode=function(mode){switch(this.settings.scaleMode=mode,this.settings.scaleMode){case this.settings.SCALE_MATCH_HEIGHT:this.setAspect=this._matchHeight;break;case this.settings.SCALE_MATCH_WIDTH:this.setAspect=this._matchWidth}},alex.utils.Viewport.prototype.createSettings=function(config){var settings={};return settings.windowWidth=-1,settings.windowHeight=-1,settings.width=config.STAGE_W,settings.height=config.STAGE_H,settings.scale=1,settings.shouldResize=!(!this.isMobile&&!this.DESKTOP_RESIZE),settings.ORIENTATION_PORTRAIT=this.PORTRAIT,settings.ORIENTATION_LANDSCAPE=this.LANDSCAPE,settings.ORIENTATION_ANY=3,settings.orientation=config.orientation||settings.ORIENTATION_LANDSCAPE,settings.SCALE_MATCH_HEIGHT=this.scaleModes.MATCH_HEIGHT,settings.SCALE_MATCH_WIDTH=this.scaleModes.MATCH_WIDTH,settings.scaleMode=-1,settings},alex.utils.Viewport.prototype.getSize=function(){var dimensions=this.checkWindowSize(),showRotate=this.checkRotation(dimensions.width,dimensions.height);return this.eventResize.wrongOrientation=showRotate,showRotate?null:(this.setAspect(dimensions.width,dimensions.height),this.settings)},alex.utils.Viewport.prototype.checkWindowSize=function(){var dstW,dstH;try{dstW=window.innerWidth,dstH=window.innerHeight}catch(e){return this.restoreDefaults(),null}if(this.isIframe&&1===this.iframeMode)try{dstW=window.parent.innerWidth,dstH=window.parent.innerHeight}catch(e){}return this.settings.windowWidth=dstW,this.settings.windowHeight=dstH,{width:dstW,height:dstH}},alex.utils.Viewport.prototype.restoreDefaults=function(){this.settings.pixelWidth=this.DEFAULT_W,this.settings.pointWidth=this.DEFAULT_W,this.settings.windowWidth=this.DEFAULT_W,this.settings.pixelHeight=this.DEFAULT_H,this.settings.pointHeight=this.DEFAULT_H,this.settings.windowHeight=this.DEFAULT_H},alex.utils.Viewport.prototype._matchWidth=function(dstW,dstH){var fullW=this.DEFAULT_W,fullH=this.DEFAULT_H;this.settings.shouldResize||(dstW=fullW,dstH=fullH);var maxRatio=fullW/this.MIN_H,aspectRatio=fullW/fullH,windowAspect=dstW/dstH;this.settings.targetH=Math.ceil(dstW/aspectRatio),windowAspect>aspectRatio&&(aspectRatio=maxRatio>=windowAspect?windowAspect:maxRatio);var w=dstW,h=dstH,targetH=Math.ceil(dstW/aspectRatio);dstH>targetH?h=targetH:w=Math.ceil(aspectRatio*dstH);var scale=w/fullW,stageW=Math.floor(w/scale),stageH=Math.floor(h/scale);this.settings.pixelWidth=w,this.settings.pointWidth=stageW,this.settings.pixelHeight=h,this.settings.pointHeight=stageH,this.settings.scale=scale},alex.utils.Viewport.prototype._matchHeight=function(dstW,dstH){var fullW=this.DEFAULT_W,fullH=this.DEFAULT_H;this.settings.shouldResize||(dstW=fullW,dstH=fullH);var minRatio,aspectRatio,windowAspect,isInPortrait=fullH>fullW;isInPortrait?(minRatio=this.MIN_H/fullW,aspectRatio=fullH/fullW,windowAspect=dstH/dstW):(minRatio=this.MIN_W/fullH,aspectRatio=fullW/fullH,windowAspect=dstW/dstH),aspectRatio>windowAspect&&(aspectRatio=windowAspect>=minRatio?windowAspect:minRatio);var w=dstW,h=dstH,scale=1;isInPortrait?(dstH>aspectRatio*dstW?h=Math.ceil(aspectRatio*dstW):w=Math.ceil(dstH/aspectRatio),scale=w/fullW):(dstW>aspectRatio*dstH?w=Math.ceil(aspectRatio*dstH):h=Math.ceil(dstW/aspectRatio),scale=h/fullH);var stageW=Math.floor(w/scale),stageH=Math.floor(h/scale);this.settings.pixelWidth=w,this.settings.pointWidth=stageW,this.settings.pixelHeight=h,this.settings.pointHeight=stageH,this.settings.scale=scale},alex.utils.Viewport.prototype.checkRotation=function(ww,hh){var showRotate=!1;return this.CHECK_ORIENTATION&&(this.settings.orientation===this.settings.ORIENTATION_LANDSCAPE&&hh>ww?showRotate=!0:this.settings.orientation===this.settings.ORIENTATION_PORTRAIT&&ww>hh&&(showRotate=!0)),showRotate?(this.gameDiv.style.display="none",this.rotateImg.style.display="block"):(this.rotateImg.style.display="none",this.gameDiv.style.display="block"),showRotate},Object.defineProperties(alex.utils.Viewport.prototype,{height:{get:function(){return this.settings.height}},width:{get:function(){return this.settings.width}}}),alex.utils.PauseController=function(){this.isPaused=!1,this.wrongOrientation=!1,this.pause=this._pause.bind(this),this.onResized=this._resized.bind(this)},alex.utils.PauseController.prototype.init=function(config){this.updateLoop=config.updateLoop,this.renderLoop=config.renderLoop,this.snd=config.snd,this.initPageHidden()},alex.utils.PauseController.prototype.initPageHidden=function(){var self=this;window.addEventListener("blur",function(){self.pause.call(self,!0)},!1),window.addEventListener("focus",function(){self.pause.call(self,!1)},!1);var hidden,visibilityChange;"undefined"!=typeof document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(hidden="mozHidden",visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),document.addEventListener(visibilityChange,function(e){document[hidden]?self.pause.call(self,!0):self.pause.call(self,!1)})},alex.utils.PauseController.prototype._resized=function(event){event.wrongOrientation?this.isPaused||(this.pause(!0),this.wrongOrientation=!0):(this.wrongOrientation&&this.pause(!1),this.wrongOrientation=!1)},alex.utils.PauseController.prototype._pause=function(p_state){p_state&&!this.isPaused?(console.log("PauseController -> "+p_state),TWEEN.pause(),this.updateLoop.stop(),this.renderLoop.stop(),this.snd.mute(!0),this.isPaused=!0):!p_state&&this.isPaused&&(console.log("PauseController -> "+p_state),TWEEN.unpause(),this.updateLoop.start(),this.renderLoop.start(),this.snd.mute(!1),this.isPaused=!1)},alex.utils.UpdateList=function(){this.updateItems=[],this.removeItems=[]},alex.utils.UpdateList.prototype.mixin=function(target){target.updateItems=[],target.removeItems=[],target.update=alex.utils.UpdateList.prototype.update,target.addUpdateItem=alex.utils.UpdateList.prototype.addUpdateItem,target.removeUpdateItem=alex.utils.UpdateList.prototype.removeUpdateItem,target.purge=alex.utils.UpdateList.prototype.purge},alex.utils.UpdateList.prototype.update=function(p_delta){var item,i,n=this.updateItems.length;for(i=n-1;i>-1;i--)item=this.updateItems[i],item.update(p_delta);if(n=this.removeItems.length,n>0){for(i=0;n>i;i++)item=this.removeItems[i],this._remove(item);this.removeItems.length=0}},alex.utils.UpdateList.prototype.purge=function(){this.updateItems.length=0,this.removeItems.length=0},alex.utils.UpdateList.prototype.addUpdateItem=alex.utils.UpdateList.prototype.add=function(p_item){-1===this.updateItems.indexOf(p_item)&&(this.updateItems[this.updateItems.length]=p_item)},alex.utils.UpdateList.prototype.removeUpdateItem=alex.utils.UpdateList.prototype.remove=function(p_item){this.removeItems[this.removeItems.length]=p_item},alex.utils.UpdateList.prototype.removeUpdateItem=alex.utils.UpdateList.prototype._remove=function(p_item){var index=this.updateItems.indexOf(p_item);index>-1&&this.updateItems.splice(index,1)},Object.defineProperty(alex.utils.UpdateList.prototype,"length",{get:function(){return this.updateItems.length}}),alex.utils.Sequence=function(stuff,randomise){this.list=[],stuff&&this.add(stuff,randomise)},alex.utils.Sequence.prototype.add=function(stuff,randomise){if(Array.isArray(stuff)){var i,n=stuff.length;for(i=0;n>i;i++)this.list[this.list.length]=stuff[i];
}else this.list[this.list.length]=stuff;randomise&&this.randomise()},alex.utils.Sequence.prototype.remove=function(stuff){var index;if(Array.isArray(stuff)){var i,item,n=stuff.length;for(i=0;n>i;i++)item=stuff[i],index=this.list.indexOf(item),index>-1&&this.list.splice(index,1)}else index=this.list.indexOf(stuff),index>-1&&this.list.splice(index,1)},alex.utils.Sequence.prototype.randomise=function(){alex.utils.Randomise.randomise(this.list)},alex.utils.Sequence.prototype.next=function(){var item=null;return this.list.length>0&&(item=this.list.shift(),this.list[this.list.length]=item),item},Object.defineProperty(alex.utils.Sequence.prototype,"length",{get:function(){return this.list.length}}),alex.utils.Save=function(key){this.key=key||"game_data",this.isSupported=this.checkSupported()},alex.utils.Save.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},alex.utils.Save.prototype.save=function(data){this.isSupported&&data&&("string"!=typeof data&&(data=JSON.stringify(data)),this._saveItem(this.key,data))},alex.utils.Save.prototype.restore=function(){if(this.isSupported)try{var stringValue=localStorage[this.key];if("undefined"!=typeof stringValue){var data=JSON.parse(stringValue);return data}}catch(e){console.log("ERROR - alex.utils.Save.restore:"),console.log(e)}return null},alex.utils.Save.prototype.checkSupported=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},alex.utils.Save.prototype._saveItem=function(p_key,p_value){var success=!0;try{localStorage.removeItem(p_key),localStorage.setItem(p_key,p_value)}catch(e){console.log("*** LOCAL STORAGE ERROR! "+e.message),success=!1}return success},alex.utils.Maths={rotate:function(point,angle,output){var x=point.x,y=point.y;return output||(output=point),output.x=Math.cos(-angle)*x+Math.sin(-angle)*y,output.y=-Math.sin(-angle)*x+Math.cos(-angle)*y,output},matrixRotatePoint:function(p,m,pt){var x=p.x,y=p.y,output=pt||p;return output.x=m.a*x+m.c*y,output.y=m.d*y+m.b*x,output},dot:function(a,b){return a.x*b.x+a.y*b.y},vectorLengthSquared:function(vector){return vector.x*vector.x+vector.y*vector.y},vectorLength:function(vector){return Math.sqrt(this.vectorLengthSquared(vector))},vectorDistanceSquared:function(vectorA,vectorB){return this.vectorLengthSquared(this.relativeVector(vectorA,vectorB))},relativeVector:function(origin,target,output){return output||(output={}),output.x=target.x-origin.x,output.y=target.y-origin.y,output},vectorDistance:function(vectorA,vectorB){return Math.sqrt(this.vectorDistanceSquared(vectorA,vectorB))},normaliseVector:function(vector){return this.scaleVector(vector,1/this.vectorLength(vector))},scaleVector:function(vector,scale,output){return output||(output=vector),output.x=vector.x*scale,output.y=vector.y*scale,output},polygonDirection:function(vertices){var i,v1,v2,next,value,n=vertices.length,total=0;for(i=0;n>i;i++)next=(i+1)%n,v1=vertices[i],v2=vertices[next],value=(v2.x-v1.x)*(v2.y-v1.y),total+=value;return total},isClockwise:function(vertices){var total=this.polygonDirection(vertices);return 0>total}},alex.load.BootStrap=function(){this.resolution=2,this.stageW=568,this.stage=null,this.barColor=16777215},alex.load.BootStrap.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.BootStrap.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.bundle={json:[],images:[]},this.step=this.stageW/2,this.createLoadBar(),this.defineBundle()},alex.load.BootStrap.prototype.defineBundle=function(){},alex.load.BootStrap.prototype.start=function(){this.loadJson()},alex.load.BootStrap.prototype.addJson=function(item){this.bundle.json[this.bundle.json.length]=item},alex.load.BootStrap.prototype.addImage=function(item){this.bundle.images[this.bundle.images.length]=item},alex.load.BootStrap.prototype.loadJson=function(){var items=this.bundle.json;if(0===items.length)this.loadImages();else{var loader=new alex.load.JsonQueue,self=this;loader.on("loaded",function(event){game_shell.json[event.id]=event.jsonData,self.growBar()}),loader.on("complete",function(event){self.loadImages.call(self)}),loader.load(items);var i,item,n=items.length;for(i=0;n>i;i++)item=items[i],game_shell.loader.urls.add(item)}},alex.load.BootStrap.prototype.loadImages=function(){var items=this.bundle.images,n=items.length;if(this.loadedImages=0,0===n)this.finished();else for(var i=0;n>i;i++)this.loadImage(items[i])},alex.load.BootStrap.prototype.loadImage=function(item){var id=item.id,self=this;game_shell.loader.urls.add(item);var baseTexture=PIXI.BaseTexture.fromImage(item.src,!1);baseTexture.hasLoaded?this.imageLoaded(baseTexture,id):baseTexture.on("loaded",function(event){self.imageLoaded(baseTexture,id)})},alex.load.BootStrap.prototype.imageLoaded=function(baseTexture,id){this.loadedImages++;for(var item,isAtlas=!1,json=this.bundle.json,n=json.length,i=0;n>i;i++)if(item=json[i],item.id===id){isAtlas=!0;break}if(isAtlas){var atlasJson=game_shell.json[id];game_shell.loader.imageLoad.addAtlasData(baseTexture,atlasJson)}else PIXI.utils.TextureCache[id]=new PIXI.Texture(baseTexture);this.loadedImages===this.bundle.images.length&&(this.growBar(),this.finished())},alex.load.BootStrap.prototype.createLoadBar=function(){var w=10,h=20;this.bar=new alex.display.Quad(w,h,this.barColor),this.bar.x=this.stageW*-.5,this.bar.y=.5*this.stageH-.5*h,this.stage.addChild(this.bar)},alex.load.BootStrap.prototype.growBar=function(){new TWEEN.Tween(this.bar).to({width:this.bar.width+this.step},50).start()},alex.load.BootStrap.prototype.finished=function(){this.stage.removeChild(this.bar),this.emit({type:"complete"})},alex.load.ImageLoader=function(){alex.utils.EventDispatcher.call(this),this.manifest=null,this.eventLoaded={type:"loaded",progress:0,img:null,success:!1,data:null}},alex.load.ImageLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.ImageLoader.prototype.constructor=alex.load.ImageLoader,alex.load.ImageLoader.prototype.load=function(items){this.numTotal=items.length,this.numLoaded=0;var item,i;for(i=0;i<this.numTotal;i++)item=items[i],item.loadState=0;this.manifest?this.manifest=this.manifest.concat(items):this.manifest=items,this.loadNext()},alex.load.ImageLoader.prototype.findNext=function(){for(var checkObj,assetData=null,n=this.manifest.length,i=0;n>i;i++)if(checkObj=this.manifest[i],0===checkObj.loadState){assetData=checkObj;break}return assetData},alex.load.ImageLoader.prototype.loadNext=function(){var assetData=this.findNext();assetData?this.loadImage(assetData):(this.manifest.length=0,this.loadComplete())},alex.load.ImageLoader.prototype.loadImage=function(assetData){var img=new Image,self=this;return img.onload=function(){img.onerror=null,assetData.loadState=1,self.imageLoaded(img,assetData)},img.onerror=function(e){console.log("ERROR - image load failed: "+assetData.src),console.log(e),assetData.loadState=2,self.imageLoaded(null,assetData)},img.src=assetData.src,img},alex.load.ImageLoader.prototype.imageLoaded=function(img,assetData){this.numLoaded++,this.eventLoaded.progress=this.numLoaded/this.numTotal,this.eventLoaded.success=null!==img,this.eventLoaded.data=assetData,this.eventLoaded.img=img,this.emit(this.eventLoaded),this.loadNext()},alex.load.ImageLoader.prototype.loadComplete=function(){this.emit({type:"complete"})},alex.load.LoadManifest=function(){this.bulkLoader=null,this.resolution=1,this.audioType=null,this.audioFolder=null,this.manifest=null},alex.load.LoadManifest.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.resolution=this.bulkLoader.resolution,this.audioType=this.bulkLoader.audioType,this.audioFolder=this.bulkLoader.audioFolder},alex.load.LoadManifest.prototype.load=function(){var path=this.bulkLoader.manifestPath,loader=new alex.load.JsonLoader(path),self=this;loader.on("loaded",function(event){var jsonData=event.data;self.bulkLoader.emit({type:"manifest_json",data:jsonData}),self.parseConfig.call(self,jsonData),self.isEmpty?game_shell.timeout.delay(function(){self.bulkLoader.loadComplete()},100):self.bulkLoader.sequence.next()}),loader.load()},alex.load.LoadManifest.prototype.parseConfig=function(p_data){this.manifest=p_data;var res=this.resolution.toString()+"x",fallback=1===this.resolution?"sd":"hd",bulkLoader=this.bulkLoader;bulkLoader.jsonManifest=this.getManifestSection("json_",res,fallback),this.setRoot(bulkLoader.jsonManifest,alex.settings.IMG_DIR),bulkLoader.imgManifest=this.getManifestSection("img_",res,fallback),bulkLoader.fontManifest=this.getManifestSection("bm_font_",res,fallback),this.manifest.hasOwnProperty("json")&&(this.setRoot(this.manifest.json,alex.settings.JSON_DIR),bulkLoader.jsonManifest=bulkLoader.jsonManifest.concat(this.manifest.json)),bulkLoader.imgManifest=this.setRoot(bulkLoader.imgManifest,alex.settings.IMG_DIR),bulkLoader.fontManifest=this.setRoot(bulkLoader.fontManifest,alex.settings.FONT_DIR),bulkLoader.urls.storeLookup(bulkLoader.jsonManifest),bulkLoader.urls.storeLookup(bulkLoader.imgManifest),bulkLoader.urls.storeLookup(bulkLoader.fontManifest),bulkLoader.webAudioManifest=this.parseAudio(this.manifest.snd_webaudio),bulkLoader.audioSpriteManifest=this.manifest.snd_sprite||{}},alex.load.LoadManifest.prototype.setRoot=function(list,root){if(!list)return[];for(var item,n=list.length,i=0;n>i;i++)item=list[i],-1===item.src.indexOf(root)&&(item.src=root+item.src);return list},alex.load.LoadManifest.prototype.getManifestSection=function(name,res,fallback){var list=null,nameWithResolution=name+res;return this.manifest.hasOwnProperty(nameWithResolution)?list=this.manifest[nameWithResolution]:(nameWithResolution=name+fallback,this.manifest.hasOwnProperty(nameWithResolution)&&(list=this.manifest[nameWithResolution])),list||(list=[]),list},alex.load.LoadManifest.prototype.parseAudio=function(input){if(!input)return[];for(var item,folder=this.audioFolder,n=input.length,i=0;n>i;i++)item=input[i],item.src=folder+item.src+this.audioType;return input},Object.defineProperties(alex.load.LoadManifest.prototype,{isEmpty:{get:function(){var loader=this.bulkLoader,count=0;return loader.jsonManifest&&(count+=loader.jsonManifest.length),loader.imgManifest&&(count+=loader.imgManifest.length),loader.fontManifest&&(count+=loader.fontManifest.length),loader.webAudioManifest&&(count+=loader.webAudioManifest.length),0===count}}}),alex.load.JSONLoadState=function(){this.bulkLoader=null,this.jsonCache=null,this.numLoaded=0,this.numTotal=0},alex.load.JSONLoadState.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.jsonLoaded=this._jsonLoaded.bind(this)},alex.load.JSONLoadState.prototype.unload=function(ids){var i,id,n=ids.length;for(i=0;n>i;i++)id=ids[i],delete this.jsonCache[id]},alex.load.JSONLoadState.prototype.load=function(){var self=this;this.queue=new alex.load.JsonQueue,this.queue.on("complete",function(){self.bulkLoader.sequence.next()}),this.queue.on("loaded",this.jsonLoaded),this.queue.load(this.bulkLoader.jsonManifest)},alex.load.JSONLoadState.prototype._jsonLoaded=function(event){var filePath=event.url,assetData=this.bulkLoader.urls.getAssetData(filePath);assetData.jsonData=event.jsonData,assetData.loaded=!0,this.jsonProgress(event.numLoaded,event.numTotal);var isAtlas=assetData.jsonData.hasOwnProperty("frames")&&assetData.jsonData.hasOwnProperty("meta")||"atlas"==assetData.type;isAtlas&&this.addImageToQueue(assetData.id,assetData.jsonData,filePath),this.jsonCache[assetData.id]=assetData.jsonData},alex.load.JSONLoadState.prototype.jsonProgress=function(numLoaded,total){this.bulkLoader.jsonLoaded(numLoaded/total)},alex.load.JSONLoadState.prototype.toString=function(){return"[JSONLoadState]"},alex.load.JSONLoadState.prototype.addImageToQueue=function(id,jsonData,jsonFilePath){for(var imgFilename=jsonData.meta.image,imgManifest=this.bulkLoader.imgManifest,n=imgManifest.length,item=null,i=0;n>i;i++)if(item=imgManifest[i],item.src.indexOf(imgFilename)>-1)return void(item.atlasData=jsonData);var data={},lastSlash=jsonFilePath.lastIndexOf("/"),folderpath=jsonFilePath.substr(0,lastSlash+1);data.src=folderpath+imgFilename,data.id=id,data.atlasData=jsonData,imgManifest[imgManifest.length]=data,this.bulkLoader.urls.add(data)},alex.load.ImageLoadState=function(){this.bulkLoader=null,this.imageLoader=new alex.load.ImageLoader,this._assets={},this._srcPaths={},this.resolution=1},alex.load.ImageLoadState.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.imageLoaded=this._imageLoaded.bind(this),this.imageProgress=this._imageProgress.bind(this),this.loadComplete=this._loadComplete.bind(this)},alex.load.ImageLoadState.prototype.load=function(){var files=this.bulkLoader.imgManifest;0===files.length?this.bulkLoader.sequence.next():(this.storeSourcePaths(files),this.imageLoader.on("loaded",this.imageLoaded),this.imageLoader.on("progress",this.imageProgress),this.imageLoader.on("complete",this.loadComplete),this.imageLoader.load(files))},alex.load.ImageLoadState.prototype._imageLoaded=function(event){var img=event.img,success=event.success,assetData=event.data;success&&(assetData.hasOwnProperty("atlasData")?this.addAtlas(img,assetData.atlasData,assetData.src):this.addTexture(img,assetData.src)),this._assets[assetData.id]=img,this.imageProgress(event)},alex.load.ImageLoadState.prototype.getAsset=function(id){return this._assets[id]},alex.load.ImageLoadState.prototype._imageProgress=function(event){this.bulkLoader.imageLoaded(event.progress)},alex.load.ImageLoadState.prototype.storeSourcePaths=function(files){var item,i,n=files.length;for(i=0;n>i;i++)item=files[i],this._srcPaths[item.id]=item.src},alex.load.ImageLoadState.prototype._loadComplete=function(){this.imageLoader.offAll(),this.bulkLoader.sequence.next()},alex.load.ImageLoadState.prototype.addTexture=function(img,src){var tx=null;if(null!==img){var baseTexture=this.createBaseTexture(img,src);tx=new PIXI.Texture(baseTexture),PIXI.utils.TextureCache[src]=tx}return tx},alex.load.ImageLoadState.prototype.createBaseTexture=function(img,src){var baseTexture=new PIXI.BaseTexture(img,null,PIXI.utils.getResolutionOfUrl(src));return baseTexture.imageUrl=src,PIXI.utils.BaseTextureCache[src]=baseTexture,baseTexture},alex.load.ImageLoadState.prototype.addAtlas=function(p_img,p_json,p_src){var baseTexture=this.createBaseTexture(p_img,p_src);this.addAtlasData(baseTexture,p_json)},alex.load.ImageLoadState.prototype.addAtlasData=function(baseTexture,p_json){var frameId,item,frameData=p_json.frames;if(Array.isArray(frameData)){var i,n=frameData.length;for(i=0;n>i;i++)item=frameData[i],this.addAtlasFrame(item,item.filename,baseTexture)}else for(frameId in frameData)frameData.hasOwnProperty(frameId)&&(item=frameData[frameId],this.addAtlasFrame(item,frameId,baseTexture))},alex.load.ImageLoadState.prototype.addAtlasFrame=function(item,key,baseTexture){var rect=item.frame,tx=null,resolution=this.resolution;if(rect){var size=null,trim=null;if(size=item.rotated?new PIXI.Rectangle(rect.x,rect.y,rect.h,rect.w):new PIXI.Rectangle(rect.x,rect.y,rect.w,rect.h),item.trimmed&&(trim=new core.Rectangle(item.spriteSourceSize.x/resolution,item.spriteSourceSize.y/resolution,item.sourceSize.w/resolution,item.sourceSize.h/resolution)),item.rotated){var temp=size.width;size.width=size.height,size.height=temp}size.x/=resolution,size.y/=resolution,size.width/=resolution,size.height/=resolution,tx=new PIXI.Texture(baseTexture,size,size.clone(),trim,item.rotated),PIXI.utils.TextureCache[key]=tx}return tx},alex.load.ImageLoadState.prototype.purge=function(){this._assets={}},alex.load.ImageLoadState.prototype.unloadImage=function(id){delete this._assets[id];var src=this._srcPaths[id];delete this._srcPaths[id],this.unloadTextures(src)},alex.load.ImageLoadState.prototype.unloadTextures=function(src){var baseTextureCache=PIXI.utils.BaseTextureCache,textureCache=PIXI.utils.TextureCache,baseTexture=baseTextureCache[src];if(baseTexture){var tx;for(var s in textureCache)textureCache.hasOwnProperty(s)&&(tx=textureCache[s],tx.baseTexture===baseTexture&&delete textureCache[s]);delete baseTextureCache[src],baseTexture.destroy()}},alex.load.ImageLoadState.prototype.unload=function(items){var i,id,n=items.length;for(i=0;n>i;i++)id=items[i],this.unloadImage(id);this.purge()},alex.load.AudioLoadState=function(){this.bulkLoader=null,this.soundLoader=null},alex.load.AudioLoadState.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},alex.load.AudioLoadState.prototype.load=function(){var bulkLoader=this.bulkLoader,soundLoader=this.soundLoader;0===bulkLoader.webAudioManifest.length?bulkLoader.sequence.next():(soundLoader.on("progress",function(event){bulkLoader.audioLoaded(event.value)}),soundLoader.on("complete",function(event){soundLoader.offAll(),bulkLoader.audioLoaded(1),bulkLoader.sequence.next()}),soundLoader.load(bulkLoader.webAudioManifest.slice()))},alex.load.FontLoadState=function(){this.bulkLoader=null,this.loadedFonts=[],this.resolution=1},alex.load.FontLoadState.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},alex.load.FontLoadState.prototype.unload=function(){var i,n=this.loadedFonts.length;for(i=0;n>i;i++)this.removeFont(this.loadedFonts[i])},alex.load.FontLoadState.prototype.removeFont=function(fontName){var fontCache=PIXI.extras.BitmapText.fonts;if(fontCache.hasOwnProperty(fontName)){var fontData=fontCache[fontName],chars=fontData.chars;for(var charCode in chars)chars.hasOwnProperty(charCode)&&delete PIXI.utils.TextureCache[charCode];delete fontCache[fontName]}},alex.load.FontLoadState.prototype.load=function(){var files=this.bulkLoader.fontManifest,n=files.length;if(0===n)this.bulkLoader.sequence.next();else for(var numLoaded=0,loader=null,dataItem=null,bulkLoader=this.bulkLoader,self=this,i=0;n>i;i++)dataItem=files[i],loader=new alex.load.BitmapFontLoader(dataItem.src,this.resolution),loader.on("loaded",function(event){numLoaded++,bulkLoader.fontLoaded(numLoaded/n),self.loadedFonts[self.loadedFonts.length]=event.name,numLoaded===n&&bulkLoader.sequence.next()}),loader.on("error",function(event){numLoaded++,bulkLoader.fontLoaded(numLoaded/n),numLoaded===n&&bulkLoader.sequence.next()}),loader.load()},alex.load.BulkLoader=function(){alex.utils.EventDispatcher.call(this),this.resolution=1,this.jsonCache=null,this.jsonManifest=null,this.imgManifest=null,this.fontManifest=null,this.webAudioManifest=null,this.audioSpriteManifest=null},alex.load.BulkLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.BulkLoader.prototype.constructor=alex.load.BulkLoader,alex.load.BulkLoader.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.webAudio=this.settings.WEB_AUDIO_ENABLED&&this.system.webAudio,alex.load.soundLoader=new alex.audio.SoundLoader,this.loadManifest=this.createLoadManifest(),this.jsonLoad=this.createJsonLoad(),this.imageLoad=this.createImageLoad(),this.audioLoad=this.createAudioLoad(),this.fontLoad=this.createFontLoad(),this.sequence=new alex.load.LoadingSequence(this,this.webAudio),this.urls=new alex.utils.UrlLookup,this.progressTracker=new alex.load.ProgressTracker(this.webAudio)},alex.load.BulkLoader.prototype.addFile=function(filepath,id,type){var manifest=this.getManifestByExtension(filepath),item=null;return null!==manifest&&(item={src:filepath,id:id},"undefined"!=typeof type&&(item.type=type),manifest[manifest.length]=item,this.urls.add(item)),item},alex.load.BulkLoader.prototype.getManifest=function(){return this.loadManifest.manifest},alex.load.BulkLoader.prototype.getManifestByExtension=function(file){var ext=file.match(/\.(\w+)$/)[0],manifest=null;switch(ext){case".png":case".jpg":manifest=this.imgManifest;break;case".json":manifest=this.jsonManifest;break;case".fnt":case".xml":manifest=this.fontManifest;break;case".ogg":case".m4a":case".mp3":case".wav":manifest=this.webAudioManifest}return manifest},alex.load.BulkLoader.prototype.contains=function(file){var i,manifest=this.getManifestByExtension(file),item=null,n=manifest.length,itemFound=!1;for(i=0;n>i;i++)if(item=manifest[i],item.src.indexOf(file)>-1){itemFound=!0;break}return itemFound},alex.load.BulkLoader.prototype.containsId=function(id,fileType){var i,manifest=this.getManifestByExtension(fileType),item=null,n=manifest.length,itemFound=!1;for(i=0;n>i;i++)if(item=manifest[i],item.id.indexOf(id)>-1){itemFound=!0;break}return itemFound},alex.load.BulkLoader.prototype.load=function(manifestPath){this.manifestPath=manifestPath,this.progressTracker.reset(),this.sequence.reset(),this.sequence.next()},alex.load.BulkLoader.prototype.loadProgress=function(){var overallProgress=this.progressTracker.overallProgress();this.emit({type:"progress",value:overallProgress})},alex.load.BulkLoader.prototype.fontLoaded=function(percent){this.progressTracker.progressFonts=percent,this.loadProgress()},alex.load.BulkLoader.prototype.imageLoaded=function(percent){this.progressTracker.progressImages=percent,this.loadProgress()},alex.load.BulkLoader.prototype.jsonLoaded=function(percent){this.progressTracker.progressJSON=percent,this.loadProgress()},alex.load.BulkLoader.prototype.audioLoaded=function(percent){this.progressTracker.progressSounds=percent,this.loadProgress()},alex.load.BulkLoader.prototype.addSounds=function(){var soundData={};if(this.webAudio)soundData.assets=this.audioLoad.soundLoader.assets,game_shell.snd.addSounds(soundData.assets);else{var manifestData=this.audioSpriteManifest;soundData.autoplay=!0,soundData.sprites=manifestData.sprites?manifestData.sprites:null,soundData.src=null,manifestData.src&&(soundData.src=alex.settings.SND_DIR+manifestData.src),game_shell.snd.addSounds(soundData)}},alex.load.BulkLoader.prototype.loadComplete=function(){this.addSounds(),this.emit({type:"complete"}),this.offAll()},alex.load.BulkLoader.prototype.unload=function(){var jsonData=this.loadManifest.manifest;jsonData&&(this.imageLoad.unload(this.getIds(this.imgManifest)),alex.load.soundLoader.unload(this.getIds(this.webAudioManifest)),this.fontLoad.unload(),this.jsonLoad.unload(this.getIds(this.jsonManifest)),this.loadManifest.manifest=null,this.jsonManifest=null,this.imgManifest=null,this.fontManifest=null,this.webAudioManifest=null,this.audioSpriteManifest=null)},alex.load.BulkLoader.prototype.getIds=function(data){var i,item,ids=[],n=data.length;for(i=0;n>i;i++)item=data[i],ids[i]=item.id;return ids},alex.load.BulkLoader.prototype.createFontLoad=function(){var fontLoad=new alex.load.FontLoadState;return fontLoad.init({resolution:this.resolution,bulkLoader:this}),fontLoad},alex.load.BulkLoader.prototype.createAudioLoad=function(){var audioLoad=new alex.load.AudioLoadState;return audioLoad.init({bulkLoader:this,soundLoader:alex.load.soundLoader}),audioLoad},alex.load.BulkLoader.prototype.createImageLoad=function(){var imageLoad=new alex.load.ImageLoadState(this);return imageLoad.init({resolution:this.resolution,bulkLoader:this}),imageLoad},alex.load.BulkLoader.prototype.createLoadManifest=function(){var loadManifest=new alex.load.LoadManifest;return loadManifest.init({resolution:this.resolution,bulkLoader:this}),loadManifest},alex.load.BulkLoader.prototype.createJsonLoad=function(){var loader=new alex.load.JSONLoadState;return loader.init({resolution:this.resolution,bulkLoader:this,jsonCache:this.jsonCache}),loader},alex.load.LoadingSequence=function(p_loader,webAudio){this.loader=p_loader,this.webAudio=webAudio,this.currentState=null},alex.load.LoadingSequence.prototype.reset=function(){this.currentState=null},alex.load.LoadingSequence.prototype.next=function(){switch(this.currentState){case null:this.currentState=this.loader.loadManifest;break;case this.loader.loadManifest:this.loader.emit({type:"manifest_loaded"}),this.currentState=this.loader.jsonLoad;break;case this.loader.jsonLoad:this.currentState=this.loader.imageLoad;break;case this.loader.imageLoad:this.currentState=this.loader.fontLoad;break;case this.loader.fontLoad:this.webAudio?this.currentState=this.loader.audioLoad:this.currentState=null;break;case this.loader.audioLoad:this.loader.addSounds(),this.currentState=null}null!==this.currentState?this.currentState.load():this.loader.loadComplete()},alex.utils.UrlLookup=function(){},alex.utils.UrlLookup.prototype.storeLookup=function(p_list){if(p_list)for(var item,n=p_list.length,i=0;n>i;i++)item=p_list[i],this.add(item)},alex.utils.UrlLookup.prototype.add=function(item){this[item.src]=item,this[item.id]=item},alex.utils.UrlLookup.prototype.getAssetData=function(key){return this[key]},alex.utils.UrlLookup.prototype.getURL=function(key){var assetData=this[key];return assetData?assetData.src:(console.log("ERROR - no asset found for key  -> "+key),null)},alex.utils.UrlLookup.prototype.pathForFile=function(fileName){var id,item,foundPath=null;for(id in this)if(this.hasOwnProperty(id)&&(item=this[id],item.hasOwnProperty("src")&&item.src.indexOf(fileName)>-1)){foundPath=item.src;break}return foundPath},alex.load.ProgressTracker=function(webAudio){this.webAudio=webAudio,this.reset(),this.total=this.webAudio?4:3},alex.load.ProgressTracker.prototype.totalProgress=function(){var prg=this.progressJSON+this.progressImages+this.progressFonts;return this.webAudio&&(prg+=this.progressSounds),prg},alex.load.ProgressTracker.prototype.overallProgress=function(){var prg=this.totalProgress();return prg/this.total},alex.load.ProgressTracker.prototype.reset=function(){this.progressJSON=0,this.progressImages=0,this.progressSounds=0,this.progressFonts=0},alex.load.ProgressTracker.prototype.debugLog=function(){var s="* ProgressTracker: \n\r";return s+=" - total: "+this.total+" \n\r",s+=" - overall: "+this.totalProgress()+" \n\r",s+=" - progressJSON: "+this.progressJSON+" \n\r",s+=" - progressImages: "+this.progressImages+" \n\r",s+=" - progressSounds: "+this.progressSounds+" \n\r",s+=" - progressFonts: "+this.progressFonts+" \n\r"},alex.load.JsonLoader=function(url){alex.utils.EventDispatcher.call(this),this.url=url,this.id=null},alex.load.JsonLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.JsonLoader.prototype.constructor=alex.load.JsonLoader,alex.load.JsonLoader.prototype.load=function(){this.ajaxRequest=new PIXI.AjaxRequest;var scope=this;this.ajaxRequest.onreadystatechange=function(){scope.onJSONLoaded()},this.jsonData=null,this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},alex.load.JsonLoader.prototype.onJSONLoaded=function(){4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status?(this.responseText=this.ajaxRequest.responseText,this.jsonData=JSON.parse(this.responseText),this.dispatchEvent({type:"loaded",data:this.jsonData})):404===this.ajaxRequest.status?this.dispatchEvent({type:"error",data:null}):0===this.ajaxRequest.status&&this.dispatchEvent({type:"error",data:null}))},PIXI.AjaxRequest=function(){var activexmodes=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:null;for(var i=0;i<activexmodes.length;i++)try{return new window.ActiveXObject(activexmodes[i])}catch(e){}},alex.load.JsonQueue=function(){alex.utils.EventDispatcher.call(this),this.queue=[],this.results={}},alex.load.JsonQueue.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.JsonQueue.prototype.constructor=alex.load.JsonQueue,alex.load.JsonQueue.prototype.load=function(p_manifest){this.queue=this.queue.concat(p_manifest),this.numTotal=this.queue.length,this.numLoaded=0,this.boundCallback=this._jsonLoaded.bind(this),this.loadNext()},alex.load.JsonQueue.prototype.loadNext=function(){if(this.queue.length>0){var obj=this.queue.shift(),id=obj.id,src=obj.src;this.results[id]=null;var loader=new alex.load.JsonLoader(src);loader.id=id,loader.on("loaded",this.boundCallback),loader.load()}else this.emit({type:"complete",results:this.results})},alex.load.JsonQueue.prototype._jsonLoaded=function(p_evt){var loader=p_evt.target,jsonData=loader.jsonData,id=loader.id;return this.results[id]=jsonData,loader.removeEventListeners(),this.numLoaded++,this.emit({type:"loaded",id:id,url:loader.url,loader:loader,numLoaded:this.numLoaded,numTotal:this.numTotal,jsonData:jsonData}),this.loadNext(),jsonData},alex.load.BitmapFontLoader=function(url,resolution){alex.utils.EventDispatcher.call(this),this.url=url,this.resolution=resolution},alex.load.BitmapFontLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.BitmapFontLoader.prototype.constructor=alex.load.BitmapFontLoader,alex.load.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new PIXI.AjaxRequest;var self=this;this.ajaxRequest.onreadystatechange=function(){self.onXMLLoaded()},this.jsonData=null,this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},alex.load.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status){var responseXML=this.ajaxRequest.responseXML;if(!responseXML||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var domparser=new DOMParser;responseXML=domparser.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var div=document.createElement("div");div.innerHTML=this.ajaxRequest.responseText,responseXML=div}this.loadFontImage(responseXML)}else 404!==this.ajaxRequest.status&&0!==this.ajaxRequest.status||this.emit({type:"error",data:null,name:null})},alex.load.BitmapFontLoader.prototype.loadFontImage=function(responseXML){var imageFile=responseXML.getElementsByTagName("page")[0].getAttribute("file"),slashIndex=this.url.lastIndexOf("/"),folderURL=this.url.substr(0,slashIndex+1),textureUrl=folderURL+imageFile,texture=PIXI.utils.TextureCache[textureUrl];if(texture)this.parseFontData(responseXML,texture);else{var img=new Image,self=this;img.onload=function(){var baseTexture=alex.load.ImageLoadState.prototype.createBaseTexture(img,textureUrl);texture=new PIXI.Texture(baseTexture),PIXI.utils.TextureCache[textureUrl]=texture,self.parseFontData(responseXML,texture)},img.src=textureUrl}},alex.load.BitmapFontLoader.prototype.parseFontData=function(responseXML,texture){var data={},info=responseXML.getElementsByTagName("info")[0],common=responseXML.getElementsByTagName("common")[0];data.font=info.getAttribute("face"),data.size=parseInt(info.getAttribute("size"),10),data.lineHeight=parseInt(common.getAttribute("lineHeight"),10),data.chars={},data.baseTexture=texture.baseTexture;for(var letters=responseXML.getElementsByTagName("char"),letter=null,i=0;i<letters.length;i++){letter=letters[i];var charCode=parseInt(letter.getAttribute("id"),10),textureRect=new PIXI.Rectangle(this.scaleValue(parseInt(letter.getAttribute("x"),10)+texture.frame.x),this.scaleValue(parseInt(letter.getAttribute("y"),10)+texture.frame.y),this.scaleValue(parseInt(letter.getAttribute("width"),10)),this.scaleValue(parseInt(letter.getAttribute("height"),10)));data.chars[charCode]={xOffset:this.scaleValue(parseInt(letter.getAttribute("xoffset"),10)),yOffset:this.scaleValue(parseInt(letter.getAttribute("yoffset"),10)),xAdvance:this.scaleValue(parseInt(letter.getAttribute("xadvance"),10)),kerning:{},texture:new PIXI.Texture(texture.baseTexture,textureRect)}}var kernings=responseXML.getElementsByTagName("kerning");for(i=0;i<kernings.length;i++){var first=this.scaleValue(parseInt(kernings[i].getAttribute("first"),10)),second=this.scaleValue(parseInt(kernings[i].getAttribute("second"),10)),amount=this.scaleValue(parseInt(kernings[i].getAttribute("amount"),10));data.chars[second].kerning[first]=amount}return PIXI.extras.BitmapText.fonts[data.font]=data,this.emit({name:data.font,data:data,type:"loaded"}),data},alex.load.BitmapFontLoader.prototype.scaleValue=function(value){
return value/this.resolution},alex.audio.MusicLoop=function(config){if(this.type=alex.audio.AudioModes.MUSIC_LOOP,config)for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.isMuted=!1,this.isPaused=!1,this.grp="music",this.volume=1},alex.audio.MusicLoop.prototype.init=function(config){this.sound=this.initSnd(config)},alex.audio.MusicLoop.prototype.initSnd=function(config){config.src+=config.audioType;var snd=document.createElement("audio");snd.preload="auto";var self=this;snd.addEventListener("loadeddata",function(){self.loadeddata=!0},!1),snd.addEventListener("canplay",function(){self.loadeddata=!0},!1),snd.loop=!0;var loopingSupported="boolean"==typeof(new Audio).loop;return loopingSupported||snd.addEventListener("ended",function(){snd.currentTime=0,snd.play()},!1),snd.autoplay=config.autoplay,snd.src=config.src,snd},alex.audio.MusicLoop.prototype.pause=function(b){this.isPaused=b,this.isPaused?this.sound.pause():this.sound.play()},alex.audio.MusicLoop.prototype.isPlaying=function(){return!this.isPaused},alex.audio.MusicLoop.prototype.update=function(elapsedTime){},alex.audio.MusicLoop.prototype.dispose=function(){null!==this.sound&&(this.sound.pause(),this.sound=null)},alex.audio.MusicLoop.prototype.mute=function(bool){this.isMuted=bool,this.sound.muted=bool,this.sound.volume=bool?0:this.volume},alex.audio.MusicLoop.prototype.muteGroup=function(grp,bool){grp==this.grp&&this.mute(bool)},alex.audio.MusicLoop.prototype.isGroupMuted=function(grp){return grp==this.grp?this.isMuted:!1},alex.audio.MusicLoop.prototype.play=function(p_id,p_vol,p_loop){this.sound.play()},alex.audio.MusicLoop.prototype.preload=function(p_id){},alex.audio.MusicLoop.prototype.stop=function(p_id){this.sound.pause()},alex.audio.MusicLoop.prototype.addSounds=function(p_id){},alex.audio.MusicLoop.prototype.stopAll=function(){},alex.audio.SndNone=function(){this.mute=function(b){},this.muteGroup=function(grp,b){},this.muteAllGroups=function(b){},this.isGroupMuted=function(blah){return!0},this.pause=function(b){},this.isPlaying=function(){return!1},this.update=function(elapsedTime){return!1},this.play=function(p_id,p_vol,p_loop){},this.stop=function(p_id){},this.stopAll=function(){},this.dispose=function(){}},alex.audio.SoundLoader=function(){alex.utils.EventDispatcher.call(this),this.assets={},this.manifest=null,this.context=null,this.numLoaded=0,this.evtProgress={type:"progress",value:0},this.evtComplete={type:"complete",value:1}},alex.audio.SoundLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.audio.SoundLoader.prototype.constructor=alex.audio.SoundLoader,alex.audio.SoundLoader.prototype.load=function(items){this.context||this.initContext(),this.manifest?this.manifest=this.manifest.concat(items):this.manifest=items,this.loadNext()},alex.audio.SoundLoader.prototype.purge=function(){this.assets={}},alex.audio.SoundLoader.prototype.unloadSound=function(id){delete this.assets[id]},alex.audio.SoundLoader.prototype.unload=function(sounds){var i,id,n=sounds.length;for(i=0;n>i;i++)id=sounds[i],this.unloadSound(id)},alex.audio.SoundLoader.prototype.initContext=function(){window.AudioContext?this.context=new AudioContext:window.webkitAudioContext&&(this.context=new webkitAudioContext)},alex.audio.SoundLoader.prototype.nextItem=function(){for(var checkObj,foundObj=null,n=this.manifest.length,i=0;n>i;i++)if(checkObj=this.manifest[i],!this.assets.hasOwnProperty(checkObj.id)){foundObj=checkObj;break}return foundObj},alex.audio.SoundLoader.prototype.countLoaded=function(){var checkObj,n=this.manifest.length;this.numLoaded=0;for(var i=0;n>i;i++)checkObj=this.manifest[i],this.assets.hasOwnProperty(checkObj.id)&&this.numLoaded++},alex.audio.SoundLoader.prototype.loadNext=function(){function updateProgress(evt){if(evt.lengthComputable){var percentComplete=evt.loaded/evt.total;self.loadProgress(percentComplete)}}var itemData=this.nextItem();if(this.countLoaded(),itemData){var request=new XMLHttpRequest;request.open("GET",itemData.src,!0),request.responseType="arraybuffer";var self=this;request.onload=function(){self.onSoundLoaded.call(self,itemData,request)},request.onerror=function(){self.assets[itemData.id]=null,self.loadProgress(),self.loadNext()},request.addEventListener("progress",updateProgress,!1);try{request.send()}catch(e){console.log("SoundLoader: XHR error "+request.status)}}else this.manifest.length=0,this.loadComplete()},alex.audio.SoundLoader.prototype.onSoundLoaded=function(itemData,request){var self=this,id=itemData.id;"function"==typeof this.context.decodeAudioData?this.context.decodeAudioData(request.response,function(decodedBuffer){itemData.soundData=decodedBuffer,self.assets[id]=itemData,self.loadProgress(),self.loadNext()},function(){self.assets[id]=null,self.loadProgress(),self.loadNext()}):(200===request.status?(window.AudioContext?itemData.soundData=this.context.createBuffer(request.response,1,44100):itemData.soundData=this.context.createBuffer(request.response,!0),this.assets[id]=itemData):this.assets[id]=null,this.loadProgress(),this.loadNext())},alex.audio.SoundLoader.prototype.loadProgress=function(progress){void 0===progress&&(progress=0);var total=this.manifest.length,amount=(this.numLoaded+progress)/total;this.evtProgress.value=amount,this.emit(this.evtProgress)},alex.audio.SoundLoader.prototype.loadComplete=function(){this.emit(this.evtComplete)},alex.audio.SndSprite=function(config){alex.utils.EventDispatcher.call(this),this.type=alex.audio.AudioModes.AUDIO_SPRITE,this.endTime=-1,this.isMuted=!1,this.audioType=config.audioType,this.isReady=!1,this.bufferingComplete=!1,this.secondsBuffered=0,this.loadeddata=!1,this.SFX="sfx",this.MUSIC="music",this.soundGroups={},this.addSoundGroup(this.SFX),this.addSoundGroup(this.MUSIC),config&&config.src&&this.setSounds(config)},alex.audio.SndSprite.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.audio.SndSprite.prototype.constructor=alex.audio.SndSprite,alex.audio.SndSprite.prototype.addSoundGroup=function(p_id){var group=new alex.audio.SoundGroup(p_id);return this.soundGroups[p_id]=group,group},alex.audio.SndSprite.prototype.setSounds=function(config){this.sprites=this.parseManifest(config.sprites),this.sound=this.initSnd(config),config.isIOS||this.preload()},alex.audio.SndSprite.prototype.parseManifest=function(p_data){if(!p_data)return[];var obj,i,soundGroup,n=p_data.length,soundData=[];for(i=0;n>i;i++)obj=p_data[i],!obj.hasOwnProperty("end")&&obj.hasOwnProperty("duration")&&(obj.end=obj.start+obj.duration),obj.hasOwnProperty("grp")||(obj.grp=this.SFX),soundData[i]=obj,soundGroup=this.soundGroups[obj.grp],soundGroup.addSound(obj);return soundData},alex.audio.SndSprite.prototype.initSnd=function(config){if(!config.src)return null;config.src+=this.audioType;var snd=document.createElement("audio");snd.preload="auto";var self=this;return snd.addEventListener("loadeddata",function(){self.loadeddata=!0},!1),snd.addEventListener("canplay",function(){self.loadeddata=!0},!1),snd.src=config.src,this.bufferSupported="undefined"!=typeof snd.buffered,snd},alex.audio.SndSprite.prototype.preload=function(){this.sound&&(this.sound.autoplay=!0,this.endTime=2.5,this.sound.play())},alex.audio.SndSprite.prototype.play=function(p_id,p_vol,p_loop){if(!this.bufferingComplete)return!1;var duration=this.sound.duration;if(isNaN(duration)||2>duration)return!1;if(this.isMuted)return this.stop(),!1;if(!this.isGamePaused){var foundObj=this.getSpriteData(p_id);if(null!==foundObj){var grpId=foundObj.grp,soundGroup=this.soundGroups[grpId];if(soundGroup.isMuted)return!1;this.endTime=foundObj.end;var success=!0;try{this.sound.paused||this.sound.pause(),this.sound.currentTime=foundObj.start,this.sound.play()}catch(e){this.endTime=-1,success=!1}return success}return!1}},alex.audio.SndSprite.prototype.stop=function(p_id){this.sound&&(this.sound.pause(),this.endTime=-1)},alex.audio.SndSprite.prototype.stopAll=function(){this.sound&&(this.sound.pause(),this.endTime=-1)},alex.audio.SndSprite.prototype.dispose=function(){this.sound&&(this.sound.pause(),this.endTime=-1,this.sound=null)},alex.audio.SndSprite.prototype.getSpriteData=function(id){for(var obj,foundObj=null,n=this.sprites.length,i=0;n>i;i++)if(obj=this.sprites[i],obj.id===id){foundObj=obj;break}return foundObj},alex.audio.SndSprite.prototype.isPlaying=function(){return this.sound?!this.sound.paused:!1},alex.audio.SndSprite.prototype.update=function(elapsedTime){if(this.loadeddata)if(this.bufferingComplete)this.endTime>-1&&this.sound.currentTime>=this.endTime&&(this.sound.pause(),this.endTime=-1,this.bufferingComplete=!0);else{if(this.bufferSupported){var timeRange=this.sound.buffered;try{this.secondsBuffered=timeRange.end(0)}catch(e){this.secondsBuffered+=elapsedTime/10}}else this.secondsBuffered+=elapsedTime/10;this.sound.duration>0&&this.secondsBuffered>=this.sound.duration&&(this.bufferingComplete=!0,this.isReady=!0,this.emit({type:"ready"}))}},alex.audio.SndSprite.prototype.mute=function(bool){this.isMuted=bool,bool&&this.stop()},alex.audio.SndSprite.prototype.muteGroup=function(grp,bool){var soundGroup=this.soundGroups[grp];soundGroup.isMuted=bool},alex.audio.SndSprite.prototype.muteAllGroups=function(b){for(var s in this.soundGroups)this.soundGroups.hasOwnProperty(s)&&this.muteGroup(s,b)},alex.audio.SndSprite.prototype.isGroupMuted=function(groupId){var soundGroup=this.soundGroups[groupId];return void 0===soundGroup?!1:soundGroup.isMuted},alex.audio.SndSprite.prototype.pause=function(b){this.isGamePaused=b,b&&this.stop()},alex.audio.SoundGroup=function(name){this.id=name,this.sounds=[],this.isMuted=!1,this.addSound=function(sndData){this.sounds[this.sounds.length]=sndData}},alex.audio.Channel=function(config){alex.utils.EventDispatcher.call(this),this.id=config.id,this.context=config.context,this.channel=null,this.eventComplete={type:"complete"},this.start=config.start||0,this.duration=config.duration||-1,this.createChannel(config),this.gainNode=this.createGainNode(),this.channel.connect(this.gainNode),this.muteNode=null,void 0!==config.volume&&(this.volume=config.volume),this.tw=null},alex.audio.Channel.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.audio.Channel.prototype.constructor=alex.audio.Channel,alex.audio.Channel.prototype.createChannel=function(config){var self=this;this.channel=this.context.createBufferSource(),this.channel.buffer=config.buffer,this.channel.loop=config.loop===!0,config.loop?(this.channel.loopStart=this.start,this.channel.loopEnd=this.start+this.duration):this.channel.onended=function(){self.emit(self.eventComplete)}},alex.audio.Channel.prototype.createGainNode=function(){return this.context.createGainNode?this.context.createGainNode():this.context.createGain?this.context.createGain():null},alex.audio.Channel.prototype.connect=function(p_muteNode){this.muteNode=p_muteNode,this.gainNode.connect(this.muteNode)},alex.audio.Channel.prototype.play=function(){var duration=this.channel.loop?1<<25:this.duration;this.channel.start?this.duration>-1?this.channel.start(0,this.start,duration):this.channel.start(0):this.channel.noteOn&&(this.duration>-1?this.channel.noteGrainOn(0,this.start,duration):this.channel.noteOn())},alex.audio.Channel.prototype.stop=function(){if(null!==this.channel)try{this.channel.stop?this.channel.stop(0):this.channel.noteOff&&this.channel.noteOff(0),this.channel.numberOfOutputs>0&&this.channel.disconnect()}catch(e){console.log("sound channel error on stop: "+e.message)}},Object.defineProperty(alex.audio.Channel.prototype,"volume",{get:function(){return this.gainNode?this.gainNode.gain.value:0},set:function(value){this.gainNode&&(this.gainNode.gain.value=value)}}),alex.audio.Channel.prototype.fadeOut=function(p_time){var time=void 0===p_time?1e3:p_time;this.tw||(this.tw=this.createTween()),this.tw.to({volume:0},time).start()},alex.audio.Channel.prototype.fadeIn=function(p_vol,p_time){var time=void 0===p_time?1e3:p_time;p_vol>1&&(p_vol=1),this.tweenFadeIn||(this.tweenFadeIn=new TWEEN.Tween(this)),this.tweenFadeIn.to({volume:p_vol},time).start()},alex.audio.Channel.prototype.fadeTo=function(p_vol,p_secs){var time=void 0===p_secs?1:p_secs;this.gainNode.gain.linearRampToValueAtTime(p_vol,this.context.currentTime+time)},alex.audio.Channel.prototype.createTween=function(){var tw=new TWEEN.Tween(this),self=this;return tw.onComplete(function(){self.stop.call(self),self.emit(self.eventComplete)}),tw},alex.audio.Channel.prototype.dispose=function(){this.removeEventListeners(),this.tw&&(this.tw.stop(),this.tw=null),null!==this.context&&(this.stop(),this.channel=null,this.gainNode.disconnect(),this.muteNode=null,this.gainNode=null,this.context=null)},alex.audio.WebAudioMgr=function(config){this.type=alex.audio.AudioModes.WEB_AUDIO,this.context=config.context||this.createContext(),this.sounds={},this.channels={},this.soundGroups={},this.catalog={},this.globalMute=new alex.audio.WebAudioSoundGroup("master",this.createGainNode()),this.globalMute.connect(this.context.destination),this.SFX="sfx",this.MUSIC="music",this.addSoundGroup(this.SFX),this.addSoundGroup(this.MUSIC),config.assets&&this.addSounds(config.assets)},alex.audio.WebAudioMgr.prototype.createContext=function(){var ctx;return window.AudioContext?ctx=new AudioContext:window.webkitAudioContext&&(ctx=new webkitAudioContext),ctx},alex.audio.WebAudioMgr.prototype.createGainNode=function(){return this.context.createGainNode?this.context.createGainNode():this.context.createGain?this.context.createGain():null},alex.audio.WebAudioMgr.prototype.play=function(id,p_vol,p_loop){var audioData=this.catalog[id],channel=null;if(void 0===audioData)return channel;var buffer=audioData.soundData;if(null!==buffer&&void 0!==buffer){var vol=p_vol||audioData.volume||1,loop=p_loop||audioData.loop||!1,start=audioData.start||0,duration=audioData.duration||-1,config={id:id,context:this.context,buffer:buffer,loop:loop,start:start,duration:duration,volume:vol};channel=new alex.audio.Channel(config);var self=this;channel.on("complete",function(event){self.stopChannel(event.target)});var group=this.soundGroups[audioData.grp];channel.connect(group.node),this.channels[id]=channel,channel.play()}return channel},alex.audio.WebAudioMgr.prototype.isPlaying=function(id){return this.channels.hasOwnProperty(id)},alex.audio.WebAudioMgr.prototype.stop=function(id){if(this.channels.hasOwnProperty(id)){var channel=this.channels[id];this.stopChannel(channel)}},alex.audio.WebAudioMgr.prototype.stopAll=function(){var id,channel;for(id in this.channels)this.channels.hasOwnProperty(id)&&(channel=this.channels[id],this.stopChannel(channel))},alex.audio.WebAudioMgr.prototype.stopChannel=function(channel){var id=channel.id;this.channels[id]===channel&&delete this.channels[id],channel.dispose(),channel=null},alex.audio.WebAudioMgr.prototype.fadeOut=function(id,p_time){if(this.channels.hasOwnProperty(id)){var channel=this.channels[id],fadeTime=void 0===p_time?1e3:p_time;channel.fadeOut(fadeTime)}},alex.audio.WebAudioMgr.prototype.fadeIn=function(id,p_vol,p_time){if(this.channels.hasOwnProperty(id)){var channel=this.channels[id];if(channel){var fadeTime=void 0===p_time?1e3:p_time,fadeVol=void 0===p_vol?1:p_vol;channel.fadeIn(fadeVol,fadeTime)}}},alex.audio.WebAudioMgr.prototype.addSounds=function(p_assets){var audioData,jsonData,id;for(id in p_assets)p_assets.hasOwnProperty(id)&&(this.sounds.hasOwnProperty(id)||(jsonData=p_assets[id],null!==jsonData.soundData&&(audioData=new alex.audio.WebAudioData(jsonData),this.sounds[id]=audioData,this.addToCatalog(audioData))))},alex.audio.WebAudioMgr.prototype.removeSounds=function(webAudioManifest){var i,data,n=webAudioManifest.length;for(i=0;n>i;i++)data=webAudioManifest[i],this.sounds.hasOwnProperty(data.id)&&delete this.sounds[data.id]},alex.audio.WebAudioMgr.prototype.purge=function(){for(var s in this.sounds)this.sounds.hasOwnProperty(s)&&delete this.sounds[s]},alex.audio.WebAudioMgr.prototype.addToCatalog=function(audioData){if(audioData.sprites){var i,sprite,sprites=audioData.sprites,n=sprites.length;for(i=0;n>i;i++)sprite=sprites[i],this.catalog[sprite.id]=sprite}else this.catalog[audioData.id]=audioData},alex.audio.WebAudioData=function(config){if(this.src=config.src,this.soundData=config.soundData,this.id=config.id,this.grp=config.grp||"sfx",this.volume=config.volume||1,this.loop=config.hasOwnProperty("loop")?config.loop:!1,this.sprites=null,config.hasOwnProperty("sprites")){var i,item,grp,id,loop,n=config.sprites.length;if(n>0)for(this.sprites=[],i=0;n>i;i++)item=config.sprites[i],id=item.id,grp=item.grp,grp||(null!==id.match(/music/i)?(grp="music",loop=item.hasOwnProperty("loop")?item.loop:!0):(grp=this.grp,loop=item.hasOwnProperty("loop")?item.loop:!1)),this.sprites[i]={id:id,start:item.start,soundData:this.soundData,grp:grp,loop:loop,duration:item.duration}}},alex.audio.WebAudioMgr.prototype.addSoundGroup=function(p_id){var gainNode=this.createGainNode(),group=new alex.audio.WebAudioSoundGroup(p_id,gainNode);return group.connect(this.globalMute.node),this.soundGroups[p_id]=group,group},alex.audio.WebAudioMgr.prototype.isGroupMuted=function(groupId){var group=this.soundGroups[groupId];return void 0===group?!1:group.isMuted},alex.audio.WebAudioMgr.prototype.mute=function(b){this.globalMute.isMuted=b,this.globalMute.volume=b?0:1},alex.audio.WebAudioMgr.prototype.muteGroup=function(grp,b){var grpNode=this.soundGroups[grp];grpNode.volume=b?0:1,grpNode.isMuted=b},alex.audio.WebAudioMgr.prototype.muteAllGroups=function(b){for(var s in this.soundGroups)this.soundGroups.hasOwnProperty(s)&&this.muteGroup(s,b)},alex.audio.WebAudioMgr.prototype.pause=function(bool){bool?this.globalMute.volume=0:this.globalMute.isMuted||(this.globalMute.volume=1)},alex.audio.WebAudioMgr.prototype.update=function(delta){},alex.audio.WebAudioMgr.prototype.wakeAudioSystem=function(){var buffer=this.context.createBuffer(1,1,22050),source=this.context.createBufferSource();source.buffer=buffer,source.connect(this.context.destination),source.play?source.play(0):source.noteOn&&source.noteOn(0)},alex.audio.WebAudioSoundGroup=function(name,gainNode){this.id=name,this.node=gainNode,this.isMuted=!1,this.connect=function(dest){this.node.connect(dest)}},Object.defineProperty(alex.audio.WebAudioSoundGroup.prototype,"volume",{get:function(){return this.node.gain.value},set:function(value){this.node.gain.value=value}}),alex.audio.SndMgr=function(){this.snd=new alex.audio.SndNone,this.audioModes=alex.audio.AudioModes,this.audioType=null,this.mode=-1,this.isMuted=!1,this.updateList=new alex.utils.UpdateList},alex.audio.AudioModes={NONE:0,WEB_AUDIO:1,AUDIO_SPRITE:2,MUSIC_LOOP:3},alex.audio.SndMgr.prototype.init=function(config){function touchHandler(){canvas.removeEventListener(event,touchHandler),self.prepare()}this.audioType=config.audioType,this.isMuted=config.isMuted;var isIOS=config.isIOS,audioEnabled=config.audioEnabled,webAudioEnabled=config.webAudioEnabled;if(audioEnabled?webAudioEnabled&&alex.utils.system.webAudio?(this.createWebAudio(config),isIOS||this.prepare()):this.createAudioSprite(config):this.initNone(),isIOS&&this.mode!==this.audioModes.NONE){var canvas=game_shell.stage.renderer.view,self=this,event="touchend";canvas.addEventListener(event,touchHandler,!1)}return this.mode},alex.audio.SndMgr.prototype.addSounds=function(data){if(this.webAudio)this.snd.addSounds(data);else{data.audioType=this.audioType;var hasSprites=null!==data.sprites,hasSrc=null!==data.src;hasSrc?hasSprites?this.snd.type===this.audioModes.AUDIO_SPRITE?this.snd.setSounds(data):this.createAudioSprite(data):this.createAudioLoop(data):this.initNone()}},alex.audio.SndMgr.prototype.createWebAudio=function(config){this.snd=new alex.audio.WebAudioMgr(config),this.mode=this.audioModes.WEB_AUDIO},alex.audio.SndMgr.prototype.createAudioSprite=function(config){this.snd&&this.snd.dispose(),this.snd=new alex.audio.SndSprite(config),this.mode=this.audioModes.AUDIO_SPRITE},alex.audio.SndMgr.prototype.createAudioLoop=function(config){this.snd&&this.snd.dispose(),this.snd=new alex.audio.MusicLoop,this.snd.init(config),this.mode=this.audioModes.MUSIC_LOOP},alex.audio.SndMgr.prototype.pause=function(p_b){this.snd.pause(p_b)},alex.audio.SndMgr.prototype.play=function(p_id,p_vol,p_loop){return this.snd.play(p_id,p_vol,p_loop)},alex.audio.SndMgr.prototype.stop=function(id){this.snd.stop(id)},alex.audio.SndMgr.prototype.stopAll=function(){this.snd.stopAll()},alex.audio.SndMgr.prototype.playWithDelay=function(p_id,p_delay,p_vol,p_loop){var snd=this.snd;return new TWEEN.Tween({w:0}).to({w:1},p_delay).onComplete(function(){snd.play(p_id,p_vol,p_loop)}).start()},alex.audio.SndMgr.prototype.isPlaying=function(id){return this.webAudio?this.snd.isPlaying(id):this.snd.isPlaying()},alex.audio.SndMgr.prototype.update=function(delta){this.updateList.update(delta),this.snd.update(delta)},alex.audio.SndMgr.prototype.fadeOut=function(id,time){this.webAudio&&this.snd.fadeOut(id,time)},alex.audio.SndMgr.prototype.fadeIn=function(id,time){this.webAudio?this.snd.fadeIn(id,time):this.snd.play(id)},alex.audio.SndMgr.prototype.mute=function(bool){this.isMuted=bool,this.snd.mute(bool)},alex.audio.SndMgr.prototype.muteGroup=function(grp,bool){this.snd.muteGroup(grp,bool)},alex.audio.SndMgr.prototype.isGroupMuted=function(groupId){return this.snd.isGroupMuted(groupId)},alex.audio.SndMgr.prototype.muteAllGroups=function(bool){this.snd.muteAllGroups(bool)},alex.audio.SndMgr.prototype.prepare=function(){this.webAudio?this.snd.wakeAudioSystem():this.snd.preload()},alex.audio.SndMgr.prototype.removeSounds=function(data){this.webAudio&&data&&this.snd.removeSounds(data)},alex.audio.SndMgr.prototype.purge=function(){this.webAudio&&this.snd.purge()},alex.audio.SndMgr.prototype.initNone=function(){this.snd&&this.snd.dispose(),this.mode=this.audioModes.NONE,this.snd=new alex.audio.SndNone},alex.audio.SndMgr.prototype.checkReady=function(){return null!==this.snd},Object.defineProperties(alex.audio.SndMgr.prototype,{isReady:{get:function(){return this.checkReady()}},webAudio:{get:function(){return this.mode===alex.audio.AudioModes.WEB_AUDIO}}}),alex.display.Stage=function(){this.centerV=!0,this.scaleModes=alex.settings.SCALE_MODES},alex.display.Stage.prototype.init=function(config){this.forceCanvas=config.forceCanvas,this.stage=new PIXI.Container,this.createRenderer(config),this.createHolder(config),this.addToDOM()},alex.display.Stage.prototype.createRenderer=function(config){var settings=config.settings;"undefined"==typeof settings.backgroundColor&&(settings.backgroundColor=0),this.forceCanvas?this.renderer=new PIXI.CanvasRenderer(config.width,config.height,settings):this.renderer=PIXI.autoDetectRenderer(config.width,config.height,settings)},alex.display.Stage.prototype.createHolder=function(config){this.content=new PIXI.Container,this.content.x=.5*config.width,this.stage.addChild(this.content)},alex.display.Stage.prototype.draw=function(){this.renderer.render(this.stage)},alex.display.Stage.prototype.resize=function(settings){var resolution=this.renderer.resolution,pixelW=settings.pixelWidth/resolution,pixelH=settings.pixelHeight/resolution;if(this.renderer.resize(pixelW,pixelH),settings.scaleMode===this.scaleModes.MATCH_WIDTH){var dif=.5*(settings.windowHeight-settings.pixelHeight);if(dif>0){var view=this.renderer.view;view.style.position="absolute",view.style.top=dif+"px"}this.content.y=.5*pixelH}else this.centerV&&(this.content.y=.5*pixelH);this.content.x=.5*pixelW,this.content.scale.x=this.content.scale.y=settings.scale/resolution,this.draw()},alex.display.Stage.prototype.addToDOM=function(){var view=this.renderer.view,gameDiv=document.getElementById("game");gameDiv.appendChild(view),view.style.marginLeft="auto",view.style.marginRight="auto",view.style.display="block"},alex.display.Quad=function(p_w,p_h,p_color,p_alpha){PIXI.Graphics.call(this),"undefined"==typeof p_color&&(p_color=16711680),this.tint=p_color,"undefined"==typeof p_h&&(p_h=100),"undefined"==typeof p_w&&(p_w=100),"object"==typeof p_w?this.fromRect(p_w):(this._width=p_w,this._height=p_h),this.drawQuad(),"undefined"==typeof p_alpha&&(p_alpha=1),this.alpha=p_alpha,this.hitArea=new PIXI.Rectangle(0,0,this._width,this._height)},alex.display.Quad.prototype=Object.create(PIXI.Graphics.prototype),alex.display.Quad.prototype.constructor=alex.display.Quad,alex.display.Quad.prototype.fromRect=function(rect){this._width=this.hitArea.width=rect.width,this._height=this.hitArea.height=rect.height,this.x=rect.x,this.y=rect.y,this.drawQuad()},alex.display.Quad.prototype.drawQuad=function(){this.clear(),this.beginFill(this.tint),this.drawRect(0,0,this._width,this._height),this.endFill()},Object.defineProperties(alex.display.Quad.prototype,{width:{get:function(){return this._width},set:function(value){this._width=value,this.drawQuad(),this.hitArea.width=value}},height:{get:function(){return this._height},set:function(value){this._height=value,this.drawQuad(),this.hitArea.height=value}}}),alex.display.Circle=function(p_radius,p_color){PIXI.Graphics.call(this),this.tint="undefined"!=typeof p_color?p_color:16711680,this.radius="undefined"!=typeof p_radius?p_radius:50},alex.display.Circle.prototype=Object.create(PIXI.Graphics.prototype),alex.display.Circle.prototype.constructor=alex.display.Circle,Object.defineProperty(alex.display.Circle.prototype,"radius",{get:function(){return this._radius},set:function(value){this._radius=value,this.clear(),this.beginFill(this.tint),this.drawCircle(0,0,this._radius),this.endFill()}}),alex.display.Button=function(p_upImgId,p_downImgId,p_disabledImgId){"string"==typeof p_upImgId?this.txUp=PIXI.utils.TextureCache[p_upImgId]:this.txUp=p_upImgId,PIXI.Sprite.call(this,this.txUp),this.upScale=1,this.downScale=1,this._pressed=!1,this.evtPress="press",this.evtRelease="release",this.evtReleaseOutside="release_outside",this.touchstart=this._touchstart.bind(this),this.on("mousedown",this.touchstart),this.on("touchstart",this.touchstart),this.touchend=this._touchend.bind(this),this.on("mouseup",this.touchend),this.on("touchend",this.touchend),this.touchendoutside=this._touchendoutside.bind(this),this.on("mouseupoutside",this.touchendoutside),this.on("touchendoutside",this.touchendoutside),this.enabled=!0,this.createHitArea(),this.setAdditionalTextures(p_downImgId,p_disabledImgId)},alex.display.Button.prototype=Object.create(PIXI.Sprite.prototype),alex.display.Button.prototype.constructor=alex.display.Button,alex.display.Button.prototype.setAdditionalTextures=function(p_downImgId,p_disabledImgId){var downType=typeof p_downImgId;p_downImgId&&"undefined"!==downType?("string"===downType?this.txDown=PIXI.utils.TextureCache[p_downImgId]:this.txDown=p_downImgId,this.downScale=1):(this.txDown=null,this.downScale=.95,this.pivot.x=.5*this.hitArea.width,this.pivot.y=.5*this.hitArea.height);var disabledType=typeof p_disabledImgId;disabledType&&"undefined"!==disabledType?"string"===disabledType?this.txDisabled=PIXI.utils.TextureCache[disabledType]:this.txDisabled=disabledType:this.txDisabled=null},alex.display.Button.prototype.createHitArea=function(){var w=this.txUp.frame.width,h=this.txUp.frame.height;this.hitArea=new PIXI.Rectangle(0,0,w,h)},alex.display.Button.prototype._touchstart=function(){this.txDown?this.setTexture(this.txDown):this.scale.x=this.scale.y=this.downScale,this._pressed=!0,this.emit(this.evtPress)},alex.display.Button.prototype._touchend=function(){this._pressed&&(this._pressed=!1,this.restore(),this.emit(this.evtRelease))},alex.display.Button.prototype._touchendoutside=function(){this._pressed&&(this._pressed=!1,this.restore(),this.emit(this.evtReleaseOutside))},alex.display.Button.prototype.restore=function(){this.downScale<1&&(this.scale.x=this.scale.y=this.upScale),this.texture!==this.txUp&&this.setTexture(this.txUp)},Object.defineProperty(alex.display.Button.prototype,"enabled",{get:function(){return this.interactive},set:function(bool){this.interactive=bool,this.buttonMode=bool,this.txDisabled&&(bool?this.setTexture(this.txUp):this.setTexture(this.txDisabled))}}),alex.display.Toggle=function(p_onImg,p_offImg,p_on){this.isOn=p_on!==!1,this.txOn=this.getTexture(p_onImg),this.txOff=this.getTexture(p_offImg),this.upScale=1,this.downScale=.95;var tx=this.isOn?this.txOn:this.txOff;PIXI.Sprite.call(this,tx),this.touchstart=this._touchstart.bind(this),this.on("mousedown",this.touchstart),this.on("touchstart",this.touchstart),this.touchend=this._touchend.bind(this),this.on("mouseup",this.touchend),this.on("touchend",this.touchend),this.touchendoutside=this._touchendoutside.bind(this),this.on("mouseupoutside",this.touchendoutside),this.on("touchendoutside",this.touchendoutside),this.anchor.x=this.anchor.y=.5,this.createHitArea(),this.enabled=!0},alex.display.Toggle.prototype=Object.create(PIXI.Sprite.prototype),alex.display.Toggle.prototype.constructor=alex.display.Toggle,alex.display.Toggle.prototype.getTexture=function(p_img){var tx=null;return tx="string"==typeof p_img?PIXI.utils.TextureCache[p_img]:p_img},alex.display.Toggle.prototype.createHitArea=function(){var w=this.txOn.frame.width,h=this.txOn.frame.height,x=w*-this.anchor.x,y=h*-this.anchor.x;this.hitArea=new PIXI.Rectangle(x,y,w,h)},alex.display.Toggle.prototype._touchstart=function(event){this._pressed=!0,this.scale.x=this.scale.y=this.downScale},alex.display.Toggle.prototype._touchend=function(event){this._pressed&&(this._pressed=!1,this.downScale<1&&(this.scale.x=this.scale.y=this.upScale),this.toggle())},alex.display.Toggle.prototype._touchendoutside=function(event){this._pressed&&(this.downScale<1&&(this.scale.x=this.scale.y=this.upScale),this._pressed=!1)},alex.display.Toggle.prototype.toggle=function(){this.isOn=!this.isOn,this.isOn?this.texture=this.txOn:this.texture=this.txOff,this.emit("toggle")},alex.display.Toggle.prototype.setOff=function(){this.texture=this.txOff,this.isOn=!1},alex.display.Toggle.prototype.setOn=function(){this.texture=this.txOn,this.isOn=!0},Object.defineProperty(alex.display.Toggle.prototype,"enabled",{get:function(){return this.interactive},set:function(value){this.interactive=value,this.buttonMode=value}}),alex.display.MovieClip=function(textures){PIXI.Sprite.call(this,textures[0]),this.textures=textures,this.eventComplete="complete",this.loop=!0,this._fps=25,this.onComplete=null,this.currentFrame=0,this.currentTime=0,this.playing=!1,this.duration=0,this.lastFrame=0,this.setDuration()},alex.display.MovieClip.prototype=Object.create(PIXI.Sprite.prototype),alex.display.MovieClip.prototype.constructor=alex.display.MovieClip,alex.display.MovieClip.prototype.gotoAndPlay=function(frameNumber){return this.gotoAndStop(frameNumber),this.playing=!0,this},alex.display.MovieClip.prototype.gotoAndStop=function(frameNumber){this.playing=!1,this.currentTime=frameNumber*(1e3/this._fps),this.currentFrame=frameNumber;var round=this.currentFrame+.5|0;return this.texture=this.textures[round%this.textures.length],this},alex.display.MovieClip.prototype.stop=function(){return this.playing=!1,this},alex.display.MovieClip.prototype.play=function(){return this.playing=!0,this},alex.display.MovieClip.prototype.setFPS=function(fps){return this._fps=fps,this.setDuration(),this},alex.display.MovieClip.prototype.updateTransform=function(){PIXI.Sprite.prototype.updateTransform.call(this)},alex.display.MovieClip.prototype.setDuration=function(){var l=this.textures.length;return this.duration=1e3/this._fps*l,this.lastFrame=l-1,this},alex.display.MovieClip.prototype.update=function(elapsed){if(this.playing){this.currentTime+=elapsed,this.currentTime>this.duration&&(this.loop?this.currentTime-=this.duration:(this.currentTime=this.duration,this.stop(),this.isComplete=!0,this.onComplete&&this.onComplete(),this.emit(this.eventComplete)));var frameIndex=Math.floor(this.currentTime/this.duration*(this.lastFrame+1));frameIndex>this.lastFrame&&(frameIndex=this.lastFrame),this.currentFrame=frameIndex,this.texture=this.textures[this.currentFrame]}},Object.defineProperties(alex.display.MovieClip.prototype,{totalFrames:{get:function(){return this.textures.length;
}},fps:{get:function(){return this._fps},set:function(value){this.setFPS(value)}}}),alex.display.MaskJpeg=function(jpegImg,pngMask,callback){var txImg=jpegImg,txMask=pngMask,canvasImg=document.createElement("canvas");canvasImg.width=txImg.width,canvasImg.height=txImg.height;var ctxImg=canvasImg.getContext("2d");ctxImg.drawImage(txImg,0,0),ctxImg.globalCompositeOperation="xor",ctxImg.drawImage(txMask,0,0);var img=new Image;return callback&&(img.onload=function(){callback(img)}),img.src=canvasImg.toDataURL(),img},alex.display.CropSprite=function(sprite){this.sprite=null,this.useCopy=!0,alex.utils.EventDispatcher.call(this),sprite&&this.init({sprite:sprite})},alex.display.CropSprite.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.display.CropSprite.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.copyFrame()},alex.display.CropSprite.prototype.copyFrame=function(){if(this.realFrame=this.sprite.texture.frame,this.frame=new PIXI.Rectangle(this.realFrame.x,this.realFrame.y,this.realFrame.width,this.realFrame.height),this.useCopy){var baseTexture=this.sprite.texture.baseTexture;this.sprite.texture=new PIXI.Texture(baseTexture,this.frame)}else this.sprite.texture.frame=this.frame},Object.defineProperties(alex.display.CropSprite.prototype,{width:{get:function(){return this.frame.width},set:function(value){this.setWidth(value)}},height:{get:function(){return this.frame.height},set:function(value){this.setHeight(value)}},heightAlt:{get:function(){return this.frame.height},set:function(value){this.setHeightAlt(value)}},x:{get:function(){return this.sprite.x},set:function(value){this.sprite.x=value}},y:{get:function(){return this.sprite.y},set:function(value){this.sprite.y=value}},visible:{get:function(){return this.sprite.visible},set:function(bool){this.sprite.visible=bool}},fullHeight:{get:function(){return this.realFrame.height}},fullWidth:{get:function(){return this.realFrame.width}}}),alex.display.CropSprite.prototype.setWidth=function(value){this.frame.width=value,this.sprite.texture.crop.width=this.frame.width,this.sprite.texture.width=this.frame.width,this.sprite.texture.requiresUpdate=!0,this.sprite.texture._updateUvs(),this.sprite.width=this.frame.width},alex.display.CropSprite.prototype.setHeight=function(value){this.frame.height=value,this.sprite.texture.crop.height=this.frame.height,this.sprite.texture.height=this.frame.height,this.sprite.texture.requiresUpdate=!0,this.sprite.texture._updateUvs(),this.sprite.height=this.frame.height},alex.display.CropSprite.prototype.setHeightAlt=function(value){this.setHeight(value),this.frame.y=this.realFrame.y+this.realFrame.height-value,this.sprite.texture.crop.y=this.frame.y},alex.display.CropSprite.prototype.restore=function(){this.sprite.texture.frame=this.realFrame,this.sprite.texture.crop.width=this.realFrame.width,this.sprite.texture.width=this.realFrame.width,this.sprite.texture.crop.y=this.realFrame.y,this.sprite.texture.crop.height=this.realFrame.height,this.sprite.texture.height=this.realFrame.height,this.sprite.texture.requiresUpdate=!0,this.sprite.texture._updateUvs()},alex.display.CropSprite.prototype.slideUp=function(y,time,amount){var fullH=amount||this.realFrame.height,distY=fullH/this.resolution;this.y=y+distY,this.height=0,new TWEEN.Tween(this).to({height:fullH,y:y},time).easing(TWEEN.Easing.Quadratic.Out).onComplete(this.onUp).start()},alex.display.CropSprite.prototype.revealUp=function(y,time,amount){var fullH=amount||this.realFrame.height;time||(time=600),this.heightAlt=0,new TWEEN.Tween(this).to({heightAlt:fullH},time).easing(TWEEN.Easing.Quadratic.Out).onComplete(this.onUp).start()},alex.display.CropSprite.prototype.revealDown=function(time,amount){new TWEEN.Tween(this).to({heightAlt:0},time).easing(TWEEN.Easing.Quadratic.Out).onComplete(this.onDown).start()},alex.display.CropSprite.prototype.slideDown=function(time,delay){var y=this.y,delay=delay||0,targetY=y+this.height/this.resolution;new TWEEN.Tween(this).to({height:0,y:targetY},time).delay(delay).easing(TWEEN.Easing.Quadratic.Out).onComplete(this.onDown).start()},alex.display.CropSprite.prototype.onUp=function(){},alex.display.CropSprite.prototype.onDown=function(){},alex.screens.ScreenBase=function(config){PIXI.Container.call(this),this.screenW=0,this.screenH=0,this.defaultW=0,this.defaultH=0,this.resolution=1,this.eventQueue=null,this.lastScreenId=null,this.snd=null;for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);alex.utils.UpdateList.prototype.mixin(this),this.delayedAction=new alex.utils.DelayedAction,this.addUpdateItem(this.delayedAction)},alex.screens.ScreenBase.prototype=Object.create(PIXI.Container.prototype),alex.screens.ScreenBase.prototype.constructor=alex.screens.ScreenBase,alex.screens.ScreenBase.prototype.run=function(){},alex.screens.ScreenBase.prototype.resize=function(p_w,p_h){this.screenW=p_w,this.screenH=p_h},alex.screens.ScreenBase.prototype.getSceneConfig=function(){return{screenW:this.screenW,screenH:this.screenH,defaultW:this.defaultW,defaultH:this.defaultH,eventQueue:this.eventQueue,snd:this.snd,resolution:this.resolution}},alex.screens.ScreenBase.prototype.createScene=function(SceneClass){var scene=new SceneClass;scene.init(this.getSceneConfig()),this.addChild(scene.root),this.addUpdateItem(scene.updateList);var self=this;return scene.on("screen",function(event){self.newScreen(event.id)}),scene},alex.screens.ScreenBase.prototype.delay=function(callback,p_ms){this.delayedAction.delay(callback,p_ms)},alex.screens.ScreenBase.prototype.render=function(delta){},alex.screens.ScreenBase.prototype.newScreen=function(p_screenId){var event;"string"==typeof p_screenId?event={type:"new_screen",screenId:p_screenId}:(event=p_screenId,event.type="new_screen"),this.eventQueue.queueEvent(event)},alex.screens.ScreenBase.prototype.dispose=function(){this.removeFromParent(),this.updateItems.length=0,this.delayedAction.dispose(),this.removeAllListeners()},alex.screens.LoadScreen=function(config){alex.screens.ScreenBase.call(this,config)},alex.screens.LoadScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),alex.screens.LoadScreen.prototype.constructor=alex.screens.LoadScreen,alex.screens.LoadScreen.prototype.run=function(){this.loadBar=this.createBar();var self=this;game_shell.loader.on("progress",function(event){self.loadBar.progress(event.value)}),game_shell.loader.on("complete",function(){self.loadBar.progress(1),self.fadeOut.call(self)})},alex.screens.LoadScreen.prototype.fadeOut=function(){var self=this;new TWEEN.Tween(this.loadBar).to({alpha:0},500).onComplete(function(){self.newScreen(self.targetScreen)}).start()},alex.screens.LoadScreen.prototype.createBar=function(){var w=200,h=30,loadBar=new alex.ui.LoadBar(w,h,0,16777215);return loadBar.pivot.x=.5*w,loadBar.pivot.y=.5*h,this.addChild(loadBar),loadBar},alex.screens.TitleScreen=function(config){alex.screens.ScreenBase.call(this,config)},alex.screens.TitleScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),alex.screens.TitleScreen.prototype.constructor=alex.screens.TitleScreen,alex.screens.TitleScreen.prototype.run=function(){},alex.screens.ScreenMgr=function(){this.currentScreen=null,this.lastScreenId=null,this.stage=null,this.snd=null,this.eventQueue=null,this.resolution=1},alex.screens.ScreenMgr.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.screens.ScreenMgr.prototype.constructor=alex.screens.ScreenMgr,alex.screens.ScreenMgr.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.showScreen=this._showScreen.bind(this),this.eventQueue.on("new_screen",this.showScreen)},alex.screens.ScreenMgr.prototype.getScreenConfig=function(p_event){var config="string"==typeof p_event?{screenId:p_event}:p_event;return config.screenW=this.settings.STAGE_W,config.screenH=this.settings.STAGE_H,config.defaultW=this.settings.DEFAULT_W,config.defaultH=this.settings.DEFAULT_H,config.resolution=this.resolution,config.eventQueue=this.eventQueue,config.lastScreenId=this.lastScreenId,config.snd=this.snd,config},alex.screens.ScreenMgr.prototype.resize=function(settings){if(null!==this.currentScreen){var pointW=settings.pointWidth,pointH=settings.pointHeight;this.currentScreen.resize(pointW,pointH)}},alex.screens.ScreenMgr.prototype.displayScreen=function(event){this.disposeScreen();var config=this.getScreenConfig(event);this.currentScreen=this.createScreen(config),this.stage.content.addChild(this.currentScreen),this.currentScreen.run()},alex.screens.ScreenMgr.prototype._showScreen=function(data,callback){var config="string"==typeof data?{screenId:data}:data,screenId=config.screenId,manifest=this.getManifestPath(screenId);config.reload?(delete config.reload,this.loadWithManifest(config,manifest,callback)):manifest&&this.currentManifest!==manifest?(this.unloadScreen(),this.loadWithManifest(config,manifest,callback)):this.displayScreen(config)},alex.screens.ScreenMgr.prototype.loadWithManifest=function(screenId,manifest,callback){this.currentManifest=manifest;var self=this;game_shell.loader.on("manifest_json",function(event){self.addToManifestJSON(screenId,event.data)}),game_shell.loader.on("manifest_loaded",function(){var data=game_shell.loader.getManifest();self.customizeManifest(screenId,data)}),"function"==typeof callback&&game_shell.loader.on("complete",function(){callback()}),game_shell.loader.load(manifest,!1),this.eventQueue.queueEvent({type:"new_screen",screenId:"load",targetScreen:screenId})},alex.screens.ScreenMgr.prototype.merge=function(target,source){var i,n=source.length;for(i=0;n>i;i++)target[target.length]=source[i]},alex.screens.ScreenMgr.prototype.getManifestPath=function(screenId){return alex.settings.JSON_DIR+"asset_manifest.json"},alex.screens.ScreenMgr.prototype.addToManifestJSON=function(screenId,jsonData){},alex.screens.ScreenMgr.prototype.customizeManifest=function(screenId,data){},alex.screens.ScreenMgr.prototype.unloadScreen=function(){game_shell.spineUtils&&game_shell.spineUtils.purge(),game_shell.snd.removeSounds(game_shell.loader.webAudioManifest),game_shell.loader.unload()},alex.screens.ScreenMgr.prototype.createScreen=function(p_event){var screen,scr=alex.screens,screenId="string"==typeof p_event?p_event:p_event.screenId;switch(screenId){case"load":screen=new scr.LoadScreen(p_event);break;case"title":screen=new scr.TitleScreen(p_event)}return screen},alex.screens.ScreenMgr.prototype.update=function(p_time){this.currentScreen&&this.currentScreen.update(p_time)},alex.screens.ScreenMgr.prototype.render=function(p_delta){this.currentScreen&&this.currentScreen.render(p_delta)},alex.screens.ScreenMgr.prototype.disposeScreen=function(){null!==this.currentScreen&&("load"!==this.currentScreen.screenId&&(this.lastScreenId=this.currentScreen.screenId),this.currentScreen.dispose(),this.currentScreen=null)},alex.screens.SceneBuilder=function(){this.scene=null,this.root=null,this.screenW=0,this.screenH=0,this.resolution=1},alex.screens.SceneBuilder.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.scene.root=new PIXI.Container,this.scene.timeout=new alex.utils.DelayedAction,this.scene.updateList=this.updateList=new alex.utils.UpdateList,this.updateList.add(this.scene)},alex.ui.LoadBar=function(p_w,p_h,p_color,p_color2){PIXI.Container.call(this);var c1=p_color||0,bg=new PIXI.Graphics;bg.beginFill(c1,1);var lineW=5,half=.5*lineW;bg.lineStyle(lineW,16777215,1),bg.drawRect(-half,-half,p_w+lineW,p_h+lineW),bg.endFill(),this.addChild(bg);var c2=p_color2||13408512,barW=p_w+lineW,barH=p_h+lineW;this.fullW=barW;var prgBar=new alex.display.Quad(barW,barH,c2);prgBar.x=-half,prgBar.y=-half;var fg=new PIXI.Graphics;fg.beginFill(c1,0),fg.lineStyle(lineW,16777215,1),fg.moveTo(0,0),fg.lineTo(p_w,0),fg.lineTo(p_w,p_h),fg.lineTo(0,p_h),fg.lineTo(0,0),fg.endFill(),this.addChild(fg),this.progress=function(p_amount){prgBar.width=p_amount*this.fullW,1===p_amount&&this.complete()},this.complete=function(){prgBar.width=this.fullW,fg.visible=!1,bg.visible=!1},this.progress(0),this.addChild(prgBar)},alex.ui.LoadBar.prototype=Object.create(PIXI.Container.prototype),alex.ui.LoadBar.prototype.constructor=alex.ui.LoadBar,alex.ui.PopupBase=function(){this.quadAlpha=.5,this.fadeTime=250,this.tweenTime=750,this.minScale=.001,this.eventOpen={type:"open"},this.eventShut={type:"shut"},this.states={HIDDEN:0,OPENING:1,SHOWN:2,CLOSING:3},this.state=this.states.HIDDEN,this.root=new PIXI.Container,this.bgQuad=this.createQuad(),this.content=this.createContentHolder(),this.tweenOpen=this.createTweenOpen(),this.tweenShut=this.createTweenShut(),this.tweenQuadIn=this.createTweenQuadIn(),this.tweenQuadOut=this.createTweenQuadOut()},alex.ui.PopupBase.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.ui.PopupBase.prototype.constructor=alex.ui.PopupBase,alex.ui.PopupBase.prototype.createQuad=function(){var w=alex.settings.DEFAULT_W+2,h=alex.settings.DEFAULT_H,bgQuad=new alex.display.Quad(w,h,0);return bgQuad.alpha=0,bgQuad.x=w*-.5,bgQuad.y=h*-.5,this.root.addChild(bgQuad),bgQuad},alex.ui.PopupBase.prototype.createContentHolder=function(){var content=new PIXI.Container;return this.root.addChild(content),content},alex.ui.PopupBase.prototype.show=function(){this.state===this.states.HIDDEN&&(this.state=this.states.OPENING,this.bgQuad.alpha=0,this.content.scale.x=this.minScale,this.content.scale.y=this.minScale,this.tweenQuadIn.start(),this.tweenOpen.start())},alex.ui.PopupBase.prototype.createTweenQuadIn=function(){return new TWEEN.Tween(this.bgQuad).to({alpha:this.quadAlpha},this.fadeTime)},alex.ui.PopupBase.prototype.createTweenQuadOut=function(){return new TWEEN.Tween(this.bgQuad).to({alpha:0},this.fadeTime)},alex.ui.PopupBase.prototype.createTweenOpen=function(){var self=this;return new TWEEN.Tween(this.content.scale).to({x:1,y:1},this.tweenTime).easing(TWEEN.Easing.Back.Out).onComplete(function(){self.state=self.states.SHOWN,self.onShown()})},alex.ui.PopupBase.prototype.onShown=function(){this.emit(this.eventOpen)},alex.ui.PopupBase.prototype.hide=function(){this.state!==this.states.CLOSING&&(this.state=this.states.CLOSING,this.tweenQuadOut.start(),this.tweenShut.start())},alex.ui.PopupBase.prototype.createTweenShut=function(){var self=this;return new TWEEN.Tween(this.content.scale).to({x:this.minScale,y:this.minScale},this.tweenTime).easing(TWEEN.Easing.Back.In).onComplete(function(){self.state=self.states.HIDDEN,self.onHidden()})},alex.ui.PopupBase.prototype.onHidden=function(){this.emit(this.eventShut)},Object.defineProperty(alex.ui.PopupBase.prototype,"isShown",{get:function(){var isShownVar=this.state===this.states.SHOWN,isOpening=this.state===this.states.OPENING;return isShownVar||isOpening}}),alex.motion.Wiggle=function(p_displayObj,p_maxRotation){alex.utils.EventDispatcher.call(this),this.img=p_displayObj,this.baseR=p_displayObj.rotation,void 0===p_maxRotation&&(p_maxRotation=.15),this.maxR=Math.PI*p_maxRotation,this.speed=.017,this.counter=0,this.duration=30},alex.motion.Wiggle.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.motion.Wiggle.prototype.constructor=alex.motion.Wiggle,alex.motion.Wiggle.prototype.startWiggle=function(){this.counter=0},alex.motion.Wiggle.prototype.update=function(delta){this.wiggle(delta)},alex.motion.Wiggle.prototype.wiggle=function(time){this.counter+=this.speed*time;var l_nSin=Math.sin(this.counter),l_nNewRotation=this.baseR-l_nSin*this.maxR;return this.img.rotation=l_nNewRotation,l_nNewRotation},alex.motion.Twanger=function(p_displayObj,p_max){alex.motion.Wiggle.call(this,p_displayObj,p_max),this.scale=1,this.decay=.95,this.MAX_R=.349,this.maxR=0,this.minR=.017},alex.motion.Twanger.prototype=Object.create(alex.motion.Wiggle.prototype),alex.motion.Twanger.prototype.constructor=alex.motion.Twanger,alex.motion.Twanger.prototype.start=function(){this.maxR=this.MAX_R},Object.defineProperty(alex.motion.Twanger.prototype,"isTwanging",{get:function(){return this.maxR>0}}),alex.motion.Twanger.prototype.update=function(time){var isMoving=!1;return this.maxR>this.minR&&(this.wiggle(time),this.maxR*=this.decay,this.maxR<1e-5&&(this.stopTwang(),this.dispatchEvent({type:"complete"})),isMoving=!0),isMoving},alex.motion.Twanger.prototype.wiggle=function(time){this.counter+=this.speed*time;var l_nSin=Math.sin(this.counter),l_nNewRotation=this.baseR-l_nSin*this.maxR;this.img.rotation=l_nNewRotation*this.scale},alex.motion.Twanger.prototype.stopTwang=function(){this.maxR=0,this.img.rotation=this.baseR},alex.motion.Oscillator=function(){this.speedX=5e-4,this.speedY=5e-4,this.time=0,this.x=0,this.y=0},alex.motion.Oscillator.prototype.init=function(config){config.speedX&&(this.speedX=config.speedX),config.speedY&&(this.speedY=config.speedY),config.time&&(this.time=config.time),config.x&&(this.x=config.x),config.y&&(this.y=config.y)},alex.motion.Oscillator.prototype.randomise=function(){this.speedX=5e-4+.001*Math.random(),this.speedY=5e-4+.001*Math.random()},alex.motion.Oscillator.prototype.reset=function(){this.time=0,this.x=0,this.y=0},alex.motion.Oscillator.prototype.update=function(p_delta){this.time+=p_delta,this.x=Math.cos(this.time*this.speedX),this.y=Math.sin(this.time*this.speedY)},alex.motion.SawTooth=function(){this._value=0,this._min=0,this._max=1,this.oscillationsPerSec=1},alex.motion.SawTooth.prototype.update=function(delta){var newValue=this._value+delta*this._step;newValue>this._max&&(newValue-=this._max),this._value=newValue},alex.motion.SawTooth.prototype.reset=function(){this._value=0},Object.defineProperty(alex.motion.SawTooth.prototype,"oscillationsPerSec",{set:function(oscillations){this._step=oscillations/1e3}}),Object.defineProperty(alex.motion.SawTooth.prototype,"value",{get:function(){return this._value}}),alex.motion.TriangleWave=function(){this._value=0,this._min=0,this._max=1,this.oscillationsPerSec=1},alex.motion.TriangleWave.prototype.update=function(delta){var newValue=this._value+delta*this._step;newValue>this._max?(this._value=this._max,this._step=-this._step):newValue<this._min?(this._value=this._min,this._step=-this._step):this._value=newValue},alex.motion.TriangleWave.prototype.reset=function(){this._value=this._min,this._step<0&&(this._step=-this._step)},Object.defineProperty(alex.motion.TriangleWave.prototype,"oscillationsPerSec",{set:function(oscillations){this._step=oscillations/500}}),Object.defineProperty(alex.motion.TriangleWave.prototype,"value",{get:function(){return this._value}}),alex.motion.ScreenShaker=function(p_target){alex.utils.EventDispatcher.call(this);var time=0;this.rootPt=new PIXI.Point,this.target=p_target,this.target&&(this.rootPt.x=this.target.x,this.rootPt.y=this.target.y),this.rangeX=10,this.pulse=.005,this.duration=3e3,this.init=function(config){config.hasOwnProperty("rangeX")&&(this.rangeX=config.rangeX),config.hasOwnProperty("duration")&&(this.duration=config.duration),config.hasOwnProperty("pulse")&&(this.pulse=config.pulse),config.hasOwnProperty("target")&&(this.target=config.target,this.rootPt.x=this.target.x,this.rootPt.y=this.target.y)},this.update=function(p_delta){if(this.isActive){time+=p_delta;var pulse=Math.sin(time*this.pulse),cos=Math.cos(time);this.target.x=this.rootPt.x+cos*this.rangeX*pulse,time>this.duration&&this.end()}},this.activate=function(){time=0,this.isActive=!0,this.rootPt.x=this.target.x,this.rootPt.y=this.target.y},this.end=function(){this.isActive=!1,this.target.x=this.rootPt.x,this.dispatchEvent({type:"complete"})}},alex.motion.ScreenShaker.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.motion.ScreenShaker.prototype.constructor=alex.motion.ScreenShaker,alex.motion.Pulsar=function(config){"undefined"!=typeof config&&this.init(config)},alex.motion.Pulsar.prototype.init=function(config){this.target=config.target,config.hasOwnProperty("target")?this.scale=config.target.scale:config.hasOwnProperty("scale")&&(this.scale=config.scale),this.maxScale=config.maxScale||1,this.minScale=config.minScale||.95,this.scaleAmount=this.maxScale-this.minScale;var startScale=config.hasOwnProperty("startScale")?config.startScale:this.minScale;this.scale.x=this.scale.y=startScale,this.rate=config.rate||.002,this.active=config.autostart||!1,this.count=startScale===this.maxScale?0:Math.PI},alex.motion.Pulsar.prototype.start=function(){this.active=!0},alex.motion.Pulsar.prototype.stop=function(){this.active=!1},alex.motion.Pulsar.prototype.reset=function(){this.count=0},alex.motion.Pulsar.prototype.update=function(delta){if(this.active){this.count+=delta*this.rate;var sin=Math.sin(this.count),scale=this.minScale+sin*this.scaleAmount;this.scale.x=this.scale.y=scale}},alex.motion.Interpolation={catmullRomInterpolation:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f);return v[0]===v[m]?(0>k&&(i=Math.floor(f=m*(1+k))),this.catmullRom(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)):0>k?v[0]-(this.catmullRom(v[0],v[0],v[1],v[1],-f)-v[0]):k>1?v[m]-(this.catmullRom(v[m],v[m],v[m-1],v[m-1],f-m)-v[m]):this.catmullRom(v[i?i-1:0],v[i],v[i+1>m?m:i+1],v[i+2>m?m:i+2],f-i)},catmullRom:function(p0,p1,p2,p3,t){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t,t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1},bezierInterpolation:function(v,k){for(var b=0,n=v.length-1,i=0;n>=i;i++)b+=Math.pow(1-k,n-i)*Math.pow(k,i)*v[i]*this.bernstein(n,i);return b},linear:function(p0,p1,t){return(p1-p0)*t+p0},linearInterpolation:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f);return 0>k?this.linear(v[0],v[1],f):k>1?this.linear(v[m],v[m-1],m-f):this.linear(v[i],v[i+1>m?m:i+1],f-i)}},alex.game.HitTest={intersects:function(Object1,Object2){var overlap=this._intersection(Object1,Object2);return overlap>0},radius:function(pt1,pt2,radius){var dist=this._distance(pt1,pt2);return radius>dist},_intersection:function(Object1,Object2){var overlap=0,obj1R=Object1.x+Object1.width,obj2R=Object2.x+Object2.width,obj1B=Object1.y+Object1.height,obj2B=Object2.y+Object2.height;if(obj1R>Object2.x&&Object1.x<obj2R&&obj1B>Object2.y&&Object1.y<obj2B){var biggestX=Math.max(Object1.x,Object2.x),smallestR=Math.min(obj1R,obj2R),overlapX=smallestR-biggestX,biggestY=Math.max(Object1.y,Object2.y),smallestB=Math.min(obj1B,obj2B),overlapY=smallestB-biggestY;overlap=Math.max(overlapX,overlapY)}return overlap},_distance:function(pt1,pt2){var distX=Math.abs(pt2.x-pt1.x),distY=Math.abs(pt2.y-pt1.y);return Math.sqrt(distX*distX+distY*distY)},containsPoint:function(point,rect){var left=rect.x,right=left+rect.width,inX=x>left&&x<right;if(!inX)return!1;var bottom=rect.y,top=bottom+rect.height,inY=y>bottom&&y<top;return inY}},alex.game.Camera=function(){this.maxY=0,this.minY=0,this.maxX=0,this.minX=0,this.trackX=0,this.defaultTrackX=0,this.trackY=0,this.defaultTrackY=0,this.moveY=!1,this.target=null},alex.game.Camera.prototype=Object.create(alex.game.HitTest),alex.game.Camera.prototype.constructor=alex.game.Camera,alex.game.Camera.prototype.init=function(config){this.oldX=-100,this.defaultTrackX=this.trackX=0,this.defaultTrackY=this.trackY=0;for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.maxX=this.bgW-.5*this.screenW,this.minX=-this.maxX,this.viewport=new PIXI.Rectangle(0,0,this.screenW,this.screenH),this.isInFrame=this._frameCheckRect,this.moveY?this.update=this._updateBoth:this.update=this._update},alex.game.Camera.prototype.reset=function(){this.trackX=this.defaultTrackX,this.trackY=this.defaultTrackY},alex.game.Camera.prototype._update=function(delta){this.move(this.target.x)},alex.game.Camera.prototype.move=function(px){px!==this.oldX&&(this.oldX=px,this.scrollX(px+this.trackX))},alex.game.Camera.prototype._updateBoth=function(delta){this.moveBoth(this.target)},alex.game.Camera.prototype.moveBoth=function(pt){pt.x!==this.oldX&&(this.oldX=pt.x,this.scrollX(pt.x+this.trackX)),pt.y!==this.oldY&&(this.oldY=pt.y,this.scrollY(pt.y+this.trackY))},alex.game.Camera.prototype.scrollX=function(px){px>this.maxX?px=this.maxX:px<this.minX&&(px=this.minX),this.scene.x=-px,this.viewport.x=px-.5*this.viewport.width},alex.game.Camera.prototype.scrollY=function(py){py>this.maxY?py=this.maxY:py<this.minY&&(py=this.minY),this.scene.y=-py,this.viewport.y=py-.5*this.viewport.height},alex.game.Camera.prototype._frameCheckPoint=function(x,y){if(this.moveY){var inX=x>this.viewport.x&&x<this.viewport.x+this.viewport.width;if(!inX)return!1;var inY=y>this.viewport.y&&y<this.viewport.y+this.viewport.height;return inX&&inY}return x>this.viewport.x&&x<this.viewport.x+this.viewport.width},alex.game.Camera.prototype._frameCheckRect=function(rect){if(this.moveY)return this.intersects(rect,this.viewport);var obj1R=rect.x+rect.width,obj2R=this.viewport.x+this.viewport.width;return obj1R>this.viewport.x&&rect.x<obj2R},alex.game.Camera.prototype.getX=function(){return this.scene.pivot.x},alex.game.Camera.prototype.getY=function(){return this.scene.pivot.y},alex.game.CameraCull=function(){this.gameObjects=[],this.camera=null,this.enabled=!0},alex.game.CameraCull.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.enabled||(this.update=function(){})},alex.game.CameraCull.prototype.add=function(item){this.gameObjects[this.gameObjects.length]=item},alex.game.CameraCull.prototype.update=function(delta){var i,obj,n=this.gameObjects.length;for(i=0;n>i;i++)obj=this.gameObjects[i],obj.graphics&&(obj.graphics.visible=this.camera.isInFrame(obj.frame))},alex.game.GameLoop=function(){this.gameObjects=[],this.itemsToRemove=[],this.cameraCulling=!1,this.userPreUpdate=!1,this.isPaused=!0},alex.game.GameLoop.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},alex.game.GameLoop.prototype.add=function(item){var i=this.gameObjects.length;return this.gameObjects[i]=item,i},alex.game.GameLoop.prototype.remove=function(item){this.itemsToRemove[this.itemsToRemove.length]=item},alex.game.GameLoop.prototype.start=function(){this.isPaused=!1},alex.game.GameLoop.prototype.stop=function(){this.isPaused=!0},alex.game.GameLoop.prototype.pause=function(bool){this.isPaused=bool},alex.game.GameLoop.prototype.update=function(p_delta){this.isPaused||(this.updateGameObjects(p_delta),this.postUpdate(p_delta),this.drawGameObjects(),this.input.check(p_delta))},alex.game.GameLoop.prototype.updateGameObjects=function(p_delta){var i,obj,n=this.gameObjects.length;for(i=0;n>i;i++)obj=this.gameObjects[i],this.userPreUpdate&&obj.preUpdate(),obj.update(p_delta),obj.remove&&(this.itemsToRemove[this.itemsToRemove.length]=obj)},alex.game.GameLoop.prototype.postUpdate=function(p_delta){var i,obj,index,n=this.itemsToRemove.length;for(i=0;n>i;i++)obj=this.itemsToRemove[i],index=this.gameObjects.indexOf(obj),index>-1&&this.gameObjects.splice(index);if(this.itemsToRemove.length=0,n=this.gameObjects.length,this.cameraCulling)for(i=0;n>i;i++)obj=this.gameObjects[i],obj.graphics&&(obj.graphics.visible=this.camera.isInFrame(obj.frame))},alex.game.GameLoop.prototype.drawGameObjects=function(){var i,obj,n=this.gameObjects.length;for(i=0;n>i;i++)obj=this.gameObjects[i],obj.needsDraw&&obj.draw()},alex.game.GameLoop.prototype.getGameObject=function(id){var i,obj,n=this.gameObjects.length,target=null;for(i=0;n>i;i++)if(obj=this.gameObjects[i],obj.id===id){target=obj;break}return target},alex.game.GameObject=function(config){this.body=null,this.shape=null,this.graphics=null,this.type=-1,this.scaling=100,this.offsetR=0,this.offsetX=0,this.offsetY=0,this.needsDraw=!0,this.frame=new PIXI.Rectangle},alex.game.GameObject.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.game.GameObject.prototype.createMultiShape=function(config,isSensor){var x=config.x/this.scaling,y=config.y/this.scaling;this.body=new p2.Body({position:[x,y],mass:config.mass||0});var i,rect,shape,w,h,n=config.shapes.length,shapes=[];for(i=0;n>i;i++)rect=config.shapes[i],w=rect.width/this.scaling,h=rect.height/this.scaling,x=rect.x/this.scaling,y=rect.y/this.scaling,shape=new p2.Rectangle(w,h),shape.material=config.friction,isSensor&&(shape.sensor=!0),this.body.addShape(shape,[x,y],rect.angle),shapes[i]=shape;return shapes},alex.game.GameObject.prototype.createRectangle=function(config){var w=config.width/this.scaling,h=config.height/this.scaling,x=config.x/this.scaling,y=config.y/this.scaling,boxShape=new p2.Rectangle(w,h),boxBody=new p2.Body({position:[x,y]});return boxBody.addShape(boxShape),boxBody.userData=this,this.body=boxBody,this.shape=boxShape,this.parse(config),boxShape},alex.game.GameObject.prototype.createCircle=function(config){var diameter=config.diameter/this.scaling,x=config.x/this.scaling,y=config.y/this.scaling,circleShape=new p2.Circle(diameter/2),circleBody=new p2.Body({position:[x,y]});return circleBody.addShape(circleShape),circleBody.userData=this,this.frame.width=this.frame.height=config.diameter,this.body=circleBody,this.shape=circleShape,this.parse(config),circleShape},alex.game.GameObject.prototype.createPolygon=function(config){this.body=new p2.Body({position:[0,0]});var i,vert,shape=config.shapes[0],vertices=[],n=shape.vertices.length;for(i=0;n>i;i++){vert=shape.vertices[i];var x=vert.x/this.scaling,y=vert.y/-this.scaling;vertices[i]=[x,y]}var isClockwise=alex.utils.Maths.isClockwise(vertices);return isClockwise&&vertices.reverse(),this.body.fromPolygon(vertices),this.parse(config),shape.vertices},alex.game.GameObject.prototype.draw=function(force){if(this.graphics&&(this.needsDraw||force)){var x=this.graphics.position.x=-(this.body.position[0]*this.scaling),y=this.graphics.position.y=-(this.body.position[1]*this.scaling);this.graphics.rotation=this.body.angle,this.frame.x=x-.5*this.frame.width,this.frame.y=y-.5*this.frame.height}},alex.game.GameObject.prototype.parse=function(config){this.resolution=config.resolution,this.setPosition(config),this.body.angle=config.angle||0,this.body.mass=config.mass||1,config.rotated&&(this.offsetR=-this.body.angle,this.offsetX=config.imgX,this.offsetY=config.imgY)},alex.game.GameObject.prototype.makeSprite=function(image){return new PIXI.Sprite(PIXI.utils.TextureCache[image])},alex.game.GameObject.prototype.updateFrame=function(){var bounds=this.graphics.getBounds();return this.frame.width=bounds.width,this.frame.height=bounds.height,this.frame.x=bounds.x,this.frame.y=bounds.y,bounds},alex.game.GameObject.prototype.setPosition=function(pt){this.body.position[0]=pt.x/this.scaling,this.body.position[1]=pt.y/this.scaling},Object.defineProperties(alex.game.GameObject.prototype,{x:{get:function(){return this.body.position[0]*this.scaling}},y:{get:function(){return this.body.position[1]*this.scaling}},height:{get:function(){return this.frame.height}},shapes:{get:function(){return this.body.shapes}},bottomEdge:{get:function(){return this.frame.y+this.frame.height}},leftEdge:{get:function(){return this.frame.x}},rightEdge:{get:function(){return this.frame.x+this.frame.width}},topEdge:{get:function(){var shapes=this.body.shapes;return 1===shapes.length&&shapes[0].type===p2.Shape.RECTANGLE?this.y+.5*shapes[0].height*this.scaling:this.frame.y}}}),alex.game.GameObject.prototype.update=function(time){},alex.game.GameObject.prototype.preUpdate=function(time){},alex.game.GameObject.prototype.debugGraphics=function(shapes,positions,parent){var i,shape,gfx,position,holder=parent||new PIXI.Container,n=shapes.length;for(i=0;n>i;i++)shape=shapes[i],position=positions[i],gfx=this.graphicsRect(shape),gfx.x=-position.x,gfx.y=-position.y,gfx.rotation=position.angle,holder.addChild(gfx);return holder},alex.game.GameObject.prototype.debugCircle=function(shape){var graphics=new PIXI.Graphics,color=16711680,fillAlpha=.4;graphics.lineStyle(2,color),graphics.beginFill(color,fillAlpha);var radius=shape.diameter*this.scaling/2;return graphics.drawCircle(0,0,radius),graphics.endFill(),graphics},alex.game.GameObject.prototype.graphicsRect=function(boxShape){var graphics=new PIXI.Graphics,color=16711680,fillAlpha=.4;graphics.lineStyle(2,color),graphics.beginFill(color,fillAlpha);var w=boxShape.width*this.scaling,h=boxShape.height*this.scaling;
return graphics.drawRect(-w/2,-h/2,w,h),graphics.endFill(),graphics},alex.game.GameObject.prototype.debugRect=function(shape){shape||(shape=this.shape);var gfx=this.graphicsRect(shape);return gfx.x=-(this.body.position[0]*this.scaling),gfx.y=-(this.body.position[1]*this.scaling),gfx.rotation=this.body.angle,gfx},alex.game.GameObject.prototype.debugFrame=function(){var q=new alex.display.Quad;return q.fromRect(this.frame),q.alpha=.5,q},alex.game.DragSprite=function(){this.useClickAndStick=!1,this.minSize=60,this.y=0,this.x=0,this.autoEnable=!0},alex.game.DragSprite.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.game.DragSprite.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.texture||(this.texture=PIXI.utils.TextureCache[this.img]),this.root=new PIXI.Sprite(this.texture),this.root.anchor.x=.5,this.root.anchor.y=.5,this.root.x=this.x,this.root.y=this.y,this.startPt=new PIXI.Point(this.x,this.y);var w=this.texture.frame.width/this.resolution,h=this.texture.frame.height/this.resolution;this.rect=new PIXI.Rectangle(0,0,w,h),w=Math.max(w,this.minSize),h=Math.max(h,this.minSize);var y=h*-.5,x=w*-.5;this.root.hitArea=new PIXI.Rectangle(x,y,w,h),this.initDrag(),this.enable(this.autoEnable)},alex.game.DragSprite.prototype.initDrag=function(){var pt=new PIXI.Point,global=new PIXI.Point,dragOffset=new PIXI.Point,root=this.root,self=this,modeDefault=1,modeClick=2,pressTime=0,useClickAndStick=this.useClickAndStick,clickThreshold=500,maxDist=20;this.dragging=0,this.touchstart=function(event){var iData=event.data;iData.getLocalPosition(root,pt),dragOffset.x=pt.x,dragOffset.y=pt.y,useClickAndStick&&(pressTime=game_shell.time,global.x=iData.global.x,global.y=iData.global.y),0===self.dragging&&(self.dragging=modeDefault,self.toFront())}.bind(this),root.on("mousedown",this.touchstart),root.on("touchstart",this.touchstart),this.touchmove=function(event){var iData=event.data;self.dragging>0&&(iData.getLocalPosition(root.parent,pt),root.x=pt.x-dragOffset.x,root.y=pt.y-dragOffset.y)}.bind(this),root.on("mousemove",this.touchmove),root.on("touchmove",this.touchmove),this.touchend=function(event){var iData=event.data,didClick=!1;if(useClickAndStick){var clickTime=game_shell.time-pressTime;if(clickThreshold>clickTime){var distX=Math.abs(iData.global.x-global.x),distY=Math.abs(iData.global.y-global.y);maxDist>distX&&maxDist>distY&&(didClick=!0)}}didClick&&self.dragging===modeDefault?self.dragging=modeClick:(self.dragging>0&&self.dropped.call(self),self.dragging=0,dragOffset.x=0,dragOffset.y=0)}.bind(this),root.on("mouseup",this.touchend),root.on("touchend",this.touchend),root.on("mouseupoutside",this.touchend),root.on("touchendoutside",this.touchend)},alex.game.DragSprite.prototype.enable=function(bool){this.root.interactive=bool,this.root.buttonMode=bool},alex.game.DragSprite.prototype.updateRect=function(){this.rect.x=this.root.x-.5*this.rect.width,this.rect.y=this.root.y-.5*this.rect.height},alex.game.DragSprite.prototype.dropped=function(){this.updateRect(),this.emit({type:"dropped",rect:this.rect})},alex.game.DragSprite.prototype.toFront=function(){var p=this.root.parent;this.root.removeFromParent(),p.addChild(this.root)},alex.game.DragSprite.prototype.setStart=function(pt){this.startPt.x=pt.x,this.startPt.y=pt.y,this.root.x=pt.x,this.root.y=pt.y,this.updateRect()},alex.game.ParticleBase=function(){this.root=null,this.texture=null,this.life=3,this.poolSize=150,this.proton=new Proton,this.rad=Math.PI/180,this.deg=180/Math.PI},alex.game.ParticleBase.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.emitter=this.createEmitter(),this.proton.addEmitter(this.emitter),this._spritePool=this._createPool(this.poolSize),this.renderer=this.createRenderer(),this.move(config.x,config.y),this.renderer.start()},alex.game.ParticleBase.prototype.dispose=function(){this.proton&&this.proton.destroy(),this.proton=null},alex.game.ParticleBase.prototype.fire=function(px,py,duration){var time=duration||.5;this.move(px,py),this.emit(time)},alex.game.ParticleBase.prototype.move=function(px,py){this.emitter.p.x=px||0,this.emitter.p.y=py||0},alex.game.ParticleBase.prototype.update=function(p_time){this.proton.update(p_time)},alex.game.ParticleBase.prototype.emit=function(p_secs){var secs=p_secs||1/0;this.emitter.emit(secs)},alex.game.ParticleBase.prototype.stop=function(andRemove){this.emitter.stopEmit(),andRemove&&this.emitter.removeAllParticles()},alex.game.ParticleBase.prototype.burst=function(){this.emitter.emit(.2)},alex.game.ParticleBase.prototype.rotate=function(radians){var degrees=radians*this.deg%360-180;this.emitter.velocity.thaPan.a=degrees},alex.game.ParticleBase.prototype.createEmitter=function(){var texture=this.texture,vx=.5*this.life,vy=this.life,mass=1,gravity=2,lx=.35*this.life,ly=.5*this.life,emitter=new Proton.BehaviourEmitter;return emitter.addInitialize(new Proton.ImageTarget(texture)),emitter.rate=new Proton.Rate(10,.1),emitter.addInitialize(new Proton.Mass(mass)),emitter.addBehaviour(new Proton.Gravity(gravity)),emitter.addInitialize(new Proton.Life(lx,ly)),emitter.addInitialize(new Proton.Velocity(new Proton.Span(vx,vy),new Proton.Span(0,360),"polar")),emitter.addBehaviour(new Proton.Scale(Proton.getSpan(.5,1.5))),emitter.addBehaviour(new Proton.Alpha(1,0,1/0,Proton.easeInQuart)),emitter.addBehaviour(new Proton.Rotate(Proton.getSpan(0,360),Proton.getSpan(-3,3),"add")),emitter},alex.game.ParticleBase.prototype.transformSprite=function(particleSprite,particle){particleSprite.x=particle.p.x,particleSprite.y=particle.p.y,particleSprite.scale.x=particle.scale,particleSprite.scale.y=particle.scale,particleSprite.alpha=particle.alpha,particleSprite.rotation=particle.rotation*this.rad},alex.game.ParticleBase.prototype._createPool=function(size){for(var sp,_spritePool=[],tx=this.texture;size>0;)size--,sp=new PIXI.Sprite(tx),sp.anchor.x=.5,sp.anchor.y=.5,_spritePool[_spritePool.length]=sp;return _spritePool},alex.game.ParticleBase.prototype.createRenderer=function(){var renderer=new Proton.Renderer("other",this.proton),self=this;return renderer.onParticleCreated=function(particle){particle.sprite=self.nextSprite(),self.root.addChild(particle.sprite)},renderer.onParticleUpdate=function(particle){self.transformSprite(particle.sprite,particle)},renderer.onParticleDead=function(particle){particle.sprite.removeFromParent()},renderer},alex.game.ParticleBase.prototype.nextSprite=function(){var sp=this._spritePool.shift();return this._spritePool[this._spritePool.length]=sp,sp},alex.game.NullParticles=function(){this.dispose=function(){},this.init=function(cfg){},this.fire=function(px,py,duration){},this.move=function(px,py){},this.update=function(p_time){},this.emit=function(p_secs){}},alex.GenericGame=function(){this.gameDiv=alex.GenericGame.prototype.setGameDiv.call(this,"game"),this.system=alex.GenericGame.prototype.createSystemInfo.call(this),this.eventQueue=alex.GenericGame.prototype.createEventQueue.call(this),this.resolutionController=alex.GenericGame.prototype.initResolution.call(this),this.viewport=alex.GenericGame.prototype.createViewport.call(this),this.stage=alex.GenericGame.prototype.createStage.call(this,alex.settings),this.snd=alex.GenericGame.prototype.createSoundManager.call(this),this.screenMgr=alex.GenericGame.prototype.createScreenManager.call(this),this.renderLoop=alex.GenericGame.prototype.createRenderLoop.call(this),this.updateList=new alex.utils.UpdateList,this.timeout=new alex.utils.DelayedAction,this.updateList.add(this.timeout),this.updateLoop=alex.GenericGame.prototype.createUpdateLoop.call(this),this.pauseController=alex.GenericGame.prototype.createPauseController.call(this),this.fullscreen=alex.GenericGame.prototype.createFullscreenManager.call(this),this.loader=alex.GenericGame.prototype.createLoader.call(this),"function"==typeof this.onReady&&this.onReady(),this.viewport.resize(),alex.GenericGame.prototype.begin.call(this),this.getURL=function(id){return this.loader.urls.getURL(id)}},alex.GenericGame.prototype.createLoader=function(){var loader=new alex.load.BulkLoader;return loader.init({resolution:this.resolution,system:this.system,settings:alex.settings,jsonCache:this.json,audioType:this.system.audioType,audioFolder:alex.settings.SND_DIR}),loader},alex.GenericGame.prototype.updateGame=function(delta){TWEEN.update(this.updateLoop.currentTime),this.updateList.update(delta),this.screenMgr.update(delta),this.snd.update(delta),this.eventQueue.dispatchQueuedEvents()},alex.GenericGame.prototype.begin=function(){this.updateLoop.start(),this.renderLoop.start()},alex.GenericGame.prototype.setGameDiv=function(name){var gameDiv=document.getElementById(name);return gameDiv.style.backgroundColor=alex.settings.BG_COLOR,gameDiv},alex.GenericGame.prototype.createEventQueue=function(){var eventQueue=new alex.utils.EventQueue;return eventQueue.on("game_event",this.onGameEvent.bind(this)),eventQueue},alex.GenericGame.prototype.createScreenManager=function(){var screenMgr=new alex.screens.ScreenMgr;return screenMgr.init({stage:this.stage,snd:this.snd,eventQueue:this.eventQueue,resolution:this.resolution,settings:alex.settings}),screenMgr},alex.GenericGame.prototype.createSystemInfo=function(){var system=new alex.utils.SystemInfo;return system.run(!0),alex.settings.AUDIO_TYPE&&(system.audioType=alex.settings.AUDIO_TYPE),alex.utils.system=system,system},alex.GenericGame.prototype.createPauseController=function(){var pauseController=new alex.utils.PauseController;return pauseController.init({updateLoop:this.updateLoop,renderLoop:this.renderLoop,snd:this.snd}),pauseController},alex.GenericGame.prototype.createFullscreenManager=function(){var fullscreenMgr=null;if(alex.utils.system.isMobile&&window.scrollTo(0,1),alex.settings.FULLSCREEN_ENABLED){var disabledOnDesktop=alex.utils.system.isDesktop&&!alex.settings.DESKTOP_FULLSCREEN;disabledOnDesktop||(fullscreenMgr=new alex.utils.FullscreenMgr,fullscreenMgr.init({canvas:this.stage.renderer.view,isMobile:alex.utils.system.isMobile}))}return fullscreenMgr},alex.GenericGame.prototype.createRenderLoop=function(){var renderLoop=new alex.utils.RenderLoop;return renderLoop.init({stage:this.stage,screenMgr:this.screenMgr,useStats:this.config.SHOW_STATS===!0}),renderLoop},alex.GenericGame.prototype.createStage=function(config){var stage=new alex.display.Stage;return stage.init({width:config.STAGE_W,height:config.STAGE_H,forceCanvas:!config.WEB_GL_ENABLED,settings:{backgroundColor:parseInt(config.BG_COLOR.substr(1),16),resolution:this.resolutionController.resolution}}),stage},alex.GenericGame.prototype.createUpdateLoop=function(){var updateLoop=new alex.utils.UpdateLoop;return updateLoop.updateGame=alex.GenericGame.prototype.updateGame.bind(this),updateLoop},alex.GenericGame.prototype.initResolution=function(){var resolutionController=new alex.utils.Resolution,forceResolution=alex.GenericGame.prototype.checkForceResolution(this.config);return resolutionController.init({forceResolution:forceResolution}),2===alex.settings.SCALE_MODE?(alex.settings.setIpad(),resolutionController.setByWidth()):(alex.settings.setIphone(),resolutionController.setByHeight()),resolutionController},alex.GenericGame.prototype.checkForceResolution=function(config){var forceResolution=config.RESOLUTION||-1,system=alex.utils.system,version=system.osVersion;return(system.isAndroid&&4>version||system.isAndroidStock)&&(forceResolution=1),forceResolution},alex.GenericGame.prototype.createSoundManager=function(){var sndMgr=new alex.audio.SndMgr,sndConfig=alex.GenericGame.prototype.getSoundConfig();return sndMgr.init(sndConfig),sndMgr},alex.GenericGame.prototype.getSoundConfig=function(){var settings=alex.settings,system=alex.utils.system;return{isIOS:system.isIOS,audioType:system.audioType,audioEnabled:settings.AUDIO_ENABLED,webAudioEnabled:settings.WEB_AUDIO_ENABLED,isMuted:settings.MUTE_STATE}},alex.GenericGame.prototype.createViewport=function(){var settings=alex.settings,scaleMode=settings.SCALE_MODE||1,isMobile=alex.utils.system.isMobile,viewport=new alex.utils.Viewport;viewport.init({CHECK_ORIENTATION:settings.CHECK_ORIENTATION&&isMobile,DESKTOP_RESIZE:settings.DESKTOP_RESIZE,DEFAULT_W:settings.DEFAULT_W,DEFAULT_H:settings.DEFAULT_H,MIN_W:settings.MIN_W,MIN_H:settings.MIN_H,STAGE_W:settings.STAGE_W,STAGE_H:settings.STAGE_H,iframeMode:settings.IFRAME_MODE,orientation:settings.ORIENTATION,isMobile:isMobile,scaleMode:scaleMode,rotateImg:document.getElementById("rotate"),gameDiv:document.getElementById("game")});var self=this;return viewport.on("resize",function(event){self.pauseController.onResized.call(self.pauseController,event),event.wrongOrientation||(settings.STAGE_W=event.settings.pointWidth,settings.STAGE_H=event.settings.pointHeight,self.stage.resize(event.settings),self.screenMgr.resize(event.settings)),isMobile&&window.scrollTo(0,1)}),viewport},alex.utils.TweenGroup=function(){alex.utils.UpdateList.call(this)},alex.utils.TweenGroup.prototype=Object.create(alex.utils.UpdateList.prototype),alex.utils.TweenGroup.prototype.update=function(p_delta){for(var item,isComplete,n=this.updateItems.length,i=n-1;i>-1;i--)item=this.updateItems[i],isComplete=item.update(p_delta),isComplete&&(this.removeItems[this.removeItems.length]=item);if(n=this.removeItems.length,n>0){for(i=0;n>i;i++)item=this.removeItems[i],this._remove(item);this.removeItems.length=0}},void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var TWEEN=TWEEN||function(){var _tweens=[];return{REVISION:"14",getAll:function(){return _tweens},removeAll:function(){_tweens=[]},pausedTweens:[],pauseTime:-1,pause:function(){this.pausedTweens=_tweens.slice(),this.removeAll(),this.pauseTime=Date.now()},unpause:function(){for(var tween,unpauseTime=Date.now(),pauseDuration=unpauseTime-this.pauseTime,numTweens=this.pausedTweens.length,i=0;numTweens>i;i++)tween=this.pausedTweens[i],tween.restart(pauseDuration),this.add(tween);this.pausedTweens.length=0},add:function(tween){_tweens.push(tween)},remove:function(tween){var i=_tweens.indexOf(tween);-1!==i&&_tweens.splice(i,1)},update:function(time){if(0===_tweens.length)return!1;for(var i=0;i<_tweens.length;)_tweens[i].update(time)?i++:_tweens.splice(i,1);return!0}}}();TWEEN.Tween=function(object){var _object=object,_valuesStart={},_valuesEnd={},_valuesStartRepeat={},_duration=1e3,_repeat=0,_yoyo=!1,_isPlaying=!1,_reversed=!1,_delayTime=0,_startTime=null,_easingFunction=TWEEN.Easing.Linear.None,_interpolationFunction=TWEEN.Interpolation.Linear,_chainedTweens=[],_onStartCallback=null,_onStartCallbackFired=!1,_onUpdateCallback=null,_onCompleteCallback=null,_onStopCallback=null;for(var field in object)_valuesStart[field]=parseFloat(object[field],10);this.to=function(properties,duration){return void 0!==duration&&(_duration=duration),_valuesEnd=properties,this},this.start=function(time){TWEEN.add(this),this._start(time)},this._start=function(time){_isPlaying=!0,_onStartCallbackFired=!1,_startTime=void 0!==time?time:Date.now(),_startTime+=_delayTime;for(var property in _valuesEnd){if(_valuesEnd[property]instanceof Array){if(0===_valuesEnd[property].length)continue;_valuesEnd[property]=[_object[property]].concat(_valuesEnd[property])}_valuesStart[property]=_object[property],_valuesStart[property]instanceof Array==!1&&(_valuesStart[property]*=1),_valuesStartRepeat[property]=_valuesStart[property]||0}return this},this.stop=function(){return _isPlaying?(TWEEN.remove(this),_isPlaying=!1,null!==_onStopCallback&&_onStopCallback.call(_object),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var i=0,numChainedTweens=_chainedTweens.length;numChainedTweens>i;i++)_chainedTweens[i].stop()},this.delay=function(amount){return _delayTime=amount,this},this.repeat=function(times){return _repeat=times,this},this.yoyo=function(yoyo){return _yoyo=yoyo,this},this.easing=function(easing){return _easingFunction=easing,this},this.interpolation=function(interpolation){return _interpolationFunction=interpolation,this},this.chain=function(){return _chainedTweens=arguments,this},this.onStart=function(callback){return _onStartCallback=callback,this},this.onUpdate=function(callback){return _onUpdateCallback=callback,this},this.onComplete=function(callback){return _onCompleteCallback=callback,this},this.onStop=function(callback){return _onStopCallback=callback,this},this.restart=function(pause_duration){_startTime+=pause_duration},this.changeDuration=function(new_duration){_duration=new_duration},this.update=function(time){var property;if(_startTime>time)return!0;_onStartCallbackFired===!1&&(null!==_onStartCallback&&_onStartCallback.call(_object),_onStartCallbackFired=!0);var elapsed=(time-_startTime)/_duration;elapsed=elapsed>1?1:elapsed;var value=_easingFunction(elapsed);for(property in _valuesEnd){var start=_valuesStart[property]||0,end=_valuesEnd[property];end instanceof Array?_object[property]=_interpolationFunction(end,value):("string"==typeof end&&(end=start+parseFloat(end,10)),"number"==typeof end&&(_object[property]=start+(end-start)*value))}if(null!==_onUpdateCallback&&_onUpdateCallback.call(_object,value),1===elapsed){if(_repeat>0){isFinite(_repeat)&&_repeat--;for(property in _valuesStartRepeat){if("string"==typeof _valuesEnd[property]&&(_valuesStartRepeat[property]=_valuesStartRepeat[property]+parseFloat(_valuesEnd[property],10)),_yoyo){var tmp=_valuesStartRepeat[property];_valuesStartRepeat[property]=_valuesEnd[property],_valuesEnd[property]=tmp}_valuesStart[property]=_valuesStartRepeat[property]}return _yoyo&&(_reversed=!_reversed),_startTime=time+_delayTime,!0}null!==_onCompleteCallback&&_onCompleteCallback.call(_object);for(var i=0,numChainedTweens=_chainedTweens.length;numChainedTweens>i;i++)_chainedTweens[i].start(time);return!1}return!0}},TWEEN.UpdateTween=function(object){var self=TWEEN.Tween.call(this,object);return this.passedTime=0,this.isCompleted=!0,this.baseUpdate=this.update,this.baseStart=this._start,this.start=function(delta){return this.isCompleted=!1,this.passedTime=Date.now(),this.baseStart(),this},this.update=function(delta){return this.isCompleted||(this.passedTime+=delta,this.isCompleted=!this.baseUpdate(this.passedTime)),this.isCompleted,this.isCompleted},self},TWEEN.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){return(k*=2)<1?.5*k*k:-.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){return(k*=2)<1?.5*k*k*k*k:-.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k*k*k:.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return 0===k?0:Math.pow(1024,k-1)},Out:function(k){return 1===k?1:1-Math.pow(2,-10*k)},InOut:function(k){return 0===k?0:1===k?1:(k*=2)<1?.5*Math.pow(1024,k-1):.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){return(k*=2)<1?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){var s,a=.1,p=.4;return 0===k?0:1===k?1:(!a||1>a?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)))},Out:function(k){var s,a=.1,p=.4;return 0===k?0:1===k?1:(!a||1>a?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1)},InOut:function(k){var s,a=.1,p=.4;return 0===k?0:1===k?1:(!a||1>a?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),(k*=2)<1?-.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)):a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1)}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=2.5949095;return(k*=2)<1?.5*(k*k*((s+1)*k-s)):.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-TWEEN.Easing.Bounce.Out(1-k)},Out:function(k){return 1/2.75>k?7.5625*k*k:2/2.75>k?7.5625*(k-=1.5/2.75)*k+.75:2.5/2.75>k?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},InOut:function(k){return.5>k?.5*TWEEN.Easing.Bounce.In(2*k):.5*TWEEN.Easing.Bounce.Out(2*k-1)+.5}}},TWEEN.Interpolation={Linear:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.Linear;return 0>k?fn(v[0],v[1],f):k>1?fn(v[m],v[m-1],m-f):fn(v[i],v[i+1>m?m:i+1],f-i)},Bezier:function(v,k){var i,b=0,n=v.length-1,pw=Math.pow,bn=TWEEN.Interpolation.Utils.Bernstein;for(i=0;n>=i;i++)b+=pw(1-k,n-i)*pw(k,i)*v[i]*bn(n,i);return b},CatmullRom:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.CatmullRom;return v[0]===v[m]?(0>k&&(i=Math.floor(f=m*(1+k))),fn(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)):0>k?v[0]-(fn(v[0],v[0],v[1],v[1],-f)-v[0]):k>1?v[m]-(fn(v[m],v[m],v[m-1],v[m-1],f-m)-v[m]):fn(v[i?i-1:0],v[i],v[i+1>m?m:i+1],v[i+2>m?m:i+2],f-i)},Utils:{Linear:function(p0,p1,t){return(p1-p0)*t+p0},Bernstein:function(n,i){var fc=TWEEN.Interpolation.Utils.Factorial;return fc(n)/fc(i)/fc(n-i)},Factorial:function(){var a=[1];return function(n){var i,s=1;if(a[n])return a[n];for(i=n;i>1;i--)s*=i;return a[n]=s}}(),CatmullRom:function(p0,p1,p2,p3,t){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t,t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}},"undefined"!=typeof module&&module.exports&&(module.exports=TWEEN);